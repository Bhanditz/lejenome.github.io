var ctor=function(){var KiiRequest,KiiUtilities,root,_Kii,_KiiSocialConnect,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},_this=this;return root="undefined"!=typeof exports&&null!==exports?new Object:this,root.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2},root.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api"},root.Kii=function(){function Kii(){}var _instance;return _instance=null,Kii.getBuildNumber=function(){return"1"},Kii.getSDKVersion=function(){return"2.1.11"},Kii.getBaseURL=function(){return _instance._baseURL},Kii.getAppID=function(){return _instance._appID},Kii.getAppKey=function(){return _instance._appKey},Kii.isLogging=function(){return _instance._logging},Kii.setLogging=function(logging){return root.Kii.logger("Setting logging: "+logging),_instance._logging=logging},Kii.initializeWithSite=function(appID,appKey,site){return null==_instance&&(_instance=new _Kii(appID,appKey,site)),root.Kii.logger("Initialized "+appID+", "+appKey+", "+site)},Kii.initialize=function(appID,appKey){return root.Kii.initializeWithSite(appID,appKey,root.KiiSite.US)},Kii.error=function(message){return console.log("KiiSDK Error => "+message)},Kii.logger=function(message){return _instance._logging?console.log(message):void 0},Kii.bucketWithName=function(bucketName){return new root.KiiBucket._bucketWithName(bucketName,null)},Kii.groupWithName=function(groupName){return new root.Kii.groupWithNameAndMembers(groupName,null)},Kii.groupWithNameAndMembers=function(groupName,members){return new root.KiiGroup.groupWithNameAndMembers(groupName,members)},Kii.logOut=function(){return _instance._currentUser=null,root.KiiSocialConnect.logOutAll()},Kii.loggedIn=function(){return null!=_instance._currentUser},Kii.getCurrentUser=function(){var user;return null!=_instance._currentUser?(user=new root.KiiUser,user._uuid=_instance._currentUser._uuid,user._username=_instance._currentUser._username,user._displayName=_instance._currentUser._displayName,user._password=_instance._currentUser._password,user._emailAddress=_instance._currentUser._emailAddress,user._phoneNumber=_instance._currentUser._phoneNumber,user._country=_instance._currentUser._country,user._created=_instance._currentUser._created,user._modified=_instance._currentUser._modified,user._emailVerified=_instance._currentUser._emailVerified,user._phoneVerified=_instance._currentUser._phoneVerified,user._accessToken=_instance._currentUser._accessToken,user._customInfo=_instance._currentUser._customInfo,root.Kii.logger("my instance:"),root.Kii.logger(user),user):null},Kii.setCurrentUser=function(user){return _instance._currentUser=new root.KiiUser,_instance._currentUser._uuid=user._uuid,_instance._currentUser._username=user._username,_instance._currentUser._displayName=user._displayName,_instance._currentUser._password=user._password,_instance._currentUser._emailAddress=user._emailAddress,_instance._currentUser._phoneNumber=user._phoneNumber,_instance._currentUser._country=user._country,_instance._currentUser._created=user._created,_instance._currentUser._modified=user._modified,_instance._currentUser._emailVerified=user._emailVerified,_instance._currentUser._phoneVerified=user._phoneVerified,_instance._currentUser._accessToken=user._accessToken,_instance._currentUser._customInfo=user._customInfo,root.Kii.logger("my instance:"),root.Kii.logger(_instance._currentUser)},Kii.authenticateAsAppAdmin=function(clientId,clientSecret,callbacks){var authCallbacks,request;return request=new KiiRequest("/oauth2/token",!1),request.setAnonymous(!0),request.setMethod("POST"),request.setData({client_id:clientId,client_secret:clientSecret}),authCallbacks={success:function(data){var admin,id,token;return token=data.access_token,id=data.id,root.Kii.logger("token: "+token),root.Kii.logger("id: "+id),admin=new root.KiiAppAdminContext({token:token,id:id}),null!=callbacks?callbacks.success(admin):void 0},failure:function(error,statusCode){return root.Kii.logger("error: "+error),root.Kii.logger("statusCode: "+statusCode),null!=callbacks?callbacks.failure(error,statusCode):void 0}},request.execute(authCallbacks,!1)},Kii}(),_Kii=function(){function _Kii(appID,appKey,site){console.log("Setting site: "+site),this._appKey=appKey,this._appID=appID,this._baseURL=site}return _Kii.prototype._logging=!1,_Kii.prototype._baseURL=null,_Kii.prototype._currentUser=null,_Kii}(),root.KiiACL=function(){function KiiACL(){this._userWithID=__bind(this._userWithID,this),this._groupWithID=__bind(this._groupWithID,this),this._getRequest=__bind(this._getRequest,this),this._saveItr=__bind(this._saveItr,this),this.save=__bind(this.save,this),this.removeACLEntry=__bind(this.removeACLEntry,this),this.putACLEntry=__bind(this.putACLEntry,this),this.listACLEntries=__bind(this.listACLEntries,this),this.aclPath=__bind(this.aclPath,this),this._setParent=__bind(this._setParent,this),this._entries=[]}var _entries,_parent,_thisACL;return _thisACL=null,_entries=null,_parent=null,KiiACL.prototype._setParent=function(_parent){this._parent=_parent},KiiACL.prototype.aclPath=function(){var bucket,bucketName,group,object,objectId,path,user;return this._parent instanceof root.KiiObject?(object=this._parent,null!=object.getBucket().getUser()?user=object.getBucket().getUser():null!=object.getBucket().getGroup()&&(group=object.getBucket().getGroup()),bucketName=object.getBucket().getBucketName(),objectId=object.getUUID()):this._parent instanceof root.KiiBucket?(bucket=this._parent,null!=bucket.getUser()?user=bucket.getUser():null!=bucket.getGroup()&&(group=bucket.getGroup()),bucketName=bucket.getBucketName()):root.Kii.error("Invalid ACL parent. Must belong to a KiiObject"),path="/",null!=group?path+="groups/"+group.getUUID()+"/":null!=user&&(path+="users/"+user.getUUID()+"/"),path+=null!=objectId?"buckets/"+bucketName+"/objects/"+objectId+"/acl":"buckets/"+bucketName+"/acl"},KiiACL.prototype.listACLEntries=function(callbacks){var listCallbacks,request,_this=this;return _thisACL=this,root.Kii.logger("Listing ACL entries"),request=this._getRequest({path:this.aclPath(),withApp:!0}),listCallbacks={success:function(data,statusCode){var action,entity,key,results,subject,value,_i,_len;if(300>statusCode&&statusCode>=200){results=[];for(key in data)for(value=data[key],"WRITE_EXISTING_OBJECT"===key?action=root.KiiACLAction.KiiACLObjectActionWrite:"READ_EXISTING_OBJECT"===key?action=root.KiiACLAction.KiiACLObjectActionRead:"QUERY_OBJECTS_IN_BUCKET"===key?action=root.KiiACLAction.KiiACLBucketActionQueryObjects:"CREATE_OBJECTS_IN_BUCKET"===key?action=root.KiiACLAction.KiiACLBucketActionCreateObjects:"DROP_BUCKET_WITH_ALL_CONTENT"===key&&(action=root.KiiACLAction.KiiACLBucketActionDropBucket),_i=0,_len=value.length;_len>_i;_i++)entity=value[_i],null!=entity.groupID?subject=_this._groupWithID(entity.groupID):null!=entity.userID&&(subject=_this._userWithID(entity.userID)),results.push(KiiACLEntry.entryWithSubject(subject,action));return callbacks.success(_thisACL,results)}return callbacks.failure(_thisACL,"Unable to retrieve ACL list")},failure:function(error){return callbacks.failure(_thisACL,error)}},request.execute(listCallbacks,!1)},KiiACL.prototype.putACLEntry=function(entry){return-1===$.inArray(entry,this._entries)?this._entries.push(entry):void 0},KiiACL.prototype.removeACLEntry=function(entry){var ndx;return ndx=$.inArray(entry,this._entries),ndx>-1?KiiUtilities.arrayRemove(this._entries,ndx,ndx):void 0},KiiACL.prototype.save=function(callbacks){return root.Kii.logger("SAving acl"),this._saveItr(0,callbacks)},KiiACL.prototype._saveItr=function(idx,callbacks){var aclEntry,path,request,_errorStr,_this=this;return _this=this,aclEntry=this._entries[idx],path=""+this.aclPath()+"/"+aclEntry.getActionString()+"/"+aclEntry.getEntityString(),root.Kii.logger("Saving single @path: "+path),request=this._getRequest({path:path,withApp:!0}),request.setMethod(aclEntry.getGrant()===!0?"PUT":"DELETE"),_errorStr=null,request.execute({success:function(){return idx<_this._entries.length-1?_this._saveItr(idx+1,callbacks):callbacks.success(_this)},failure:function(errorStr){return callbacks.failure(_this,errorStr)}},!1)},KiiACL.aclWithParent=function(parent){var acl;return acl=new root.KiiACL,acl._setParent(parent),acl},KiiACL.prototype._getRequest=function(spec){var path,request,withApp;return path=spec.path,withApp=spec.withApp,request=new KiiRequest(path,withApp)},KiiACL.prototype._groupWithID=function(id){var group;return group=root.KiiGroup._groupWithID(id)},KiiACL.prototype._userWithID=function(id){var user;return user=root.KiiUser._userWithID(id)},KiiACL}.call(this),root.KiiACLAction={KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLObjectActionRead:3,KiiACLObjectActionWrite:4},root.KiiACLEntry=function(){function KiiACLEntry(){this.getEntityString=__bind(this.getEntityString,this),this.getActionString=__bind(this.getActionString,this),this.getGrant=__bind(this.getGrant,this),this.setGrant=__bind(this.setGrant,this),this.getSubject=__bind(this.getSubject,this),this.setSubject=__bind(this.setSubject,this),this.getAction=__bind(this.getAction,this),this.setAction=__bind(this.setAction,this),this._action=-1,this._grant=!0}var _action,_grant,_subject;return _action=null,_subject=null,_grant=null,KiiACLEntry.prototype.setAction=function(value){if(value>=root.KiiACLAction.KiiACLBucketActionCreateObjects&&value<=root.KiiACLAction.KiiACLObjectActionWrite)return this._action=value;throw new InvalidACLAction},KiiACLEntry.prototype.getAction=function(){return this._action},KiiACLEntry.prototype.setSubject=function(value){if(value instanceof root.KiiGroup||value instanceof root.KiiUser||value instanceof root.KiiAnyAuthenticatedUser||value instanceof root.KiiAnonymousUser)return this._subject=value;throw new InvalidACLSubject},KiiACLEntry.prototype.getSubject=function(){return this._subject},KiiACLEntry.prototype.setGrant=function(value){if(value===!0||value===!1)return this._grant=value;throw new InvalidACLGrant},KiiACLEntry.prototype.getGrant=function(){return this._grant},KiiACLEntry.entryWithSubject=function(subject,action){var entry;return root.Kii.logger("EWS: "+subject+", "+action),entry=new root.KiiACLEntry,entry.setSubject(subject),entry.setAction(action),entry},KiiACLEntry.prototype.getActionString=function(){var retString;switch(root.Kii.logger("Action: "+this.action),this._action){case root.KiiACLAction.KiiACLBucketActionCreateObjects:retString="CREATE_OBJECTS_IN_BUCKET";break;case root.KiiACLAction.KiiACLBucketActionQueryObjects:retString="QUERY_OBJECTS_IN_BUCKET";break;case root.KiiACLAction.KiiACLBucketActionDropBucket:retString="DROP_BUCKET_WITH_ALL_CONTENT";break;case root.KiiACLAction.KiiACLObjectActionRead:retString="READ_EXISTING_OBJECT";break;case root.KiiACLAction.KiiACLObjectActionWrite:retString="WRITE_EXISTING_OBJECT";break;default:return retString}return retString},KiiACLEntry.prototype.getEntityString=function(){var entityId,type;return this._subject instanceof root.KiiGroup?(entityId=this._subject.getUUID(),type="GroupID"):this._subject instanceof root.KiiUser?(entityId=this._subject.getUUID(),type="UserID"):this._subject instanceof root.KiiAnyAuthenticatedUser?(type="UserID",entityId="ANY_AUTHENTICATED_USER"):this._subject instanceof root.KiiAnonymousUser&&(type="UserID",entityId="ANONYMOUS_USER"),""+type+":"+entityId},KiiACLEntry}.call(this),root.KiiBucket=function(){function KiiBucket(bucketName,parent){this.objectWithJSON=__bind(this.objectWithJSON,this),this._generatePath=__bind(this._generatePath,this),this._getRequest=__bind(this._getRequest,this),this["delete"]=__bind(this["delete"],this),this.executeQuery=__bind(this.executeQuery,this),this.acl=__bind(this.acl,this),this.createObjectWithType=__bind(this.createObjectWithType,this),this.createObject=__bind(this.createObject,this),this._setBucketName=__bind(this._setBucketName,this),this.getBucketName=__bind(this.getBucketName,this),this._setGroup=__bind(this._setGroup,this),this.getGroup=__bind(this.getGroup,this),this._setUser=__bind(this._setUser,this),this.getUser=__bind(this.getUser,this),this._bucketName=bucketName,null!=parent&&(parent instanceof root.KiiGroup?this._group=parent:parent instanceof root.KiiUser&&(this._user=parent))}var _bucketName,_group,_thisBucket,_user;return KiiBucket.prototype._className="KiiBucket",_thisBucket=null,_bucketName=null,_user=null,_group=null,KiiBucket.prototype.getUser=function(){return this._user},KiiBucket.prototype._setUser=function(_user){this._user=_user},KiiBucket.prototype.getGroup=function(){return this._group},KiiBucket.prototype._setGroup=function(_group){this._group=_group},KiiBucket.prototype.getBucketName=function(){return this._bucketName},KiiBucket.prototype._setBucketName=function(_bucketName){this._bucketName=_bucketName},KiiBucket.prototype.createObject=function(){return root.KiiObject.objectWithBucket(this,null)},KiiBucket.prototype.createObjectWithType=function(type){return root.KiiObject.objectWithBucket(this,type)},KiiBucket.prototype.acl=function(){return root.KiiACL.aclWithParent(this)},KiiBucket.prototype.executeQuery=function(query,callbacks){var clauseData,data,executeCallbacks,path,request;return _thisBucket=this,path=this._generatePath()+"/query",data={},null!=query?(clauseData=query._dictValue(),data.bestEffortLimit=query.getLimit(),null!=query.getPaginationKey()&&(data.paginationKey=query.getPaginationKey())):clauseData={clause:root.KiiQuery._emptyDictValue()},request=this._getRequest({path:path,withApp:!0}),request.setMethod("POST"),request.setContentType("application/vnd.kii.QueryRequest+json"),data.bucketQuery=clauseData,request.setData(data),executeCallbacks={success:function(data,statusCode){var nextQuery,result,resultSet,_i,_len,_ref;if(300>statusCode&&statusCode>=200){for(resultSet=[],_ref=data.results,_i=0,_len=_ref.length;_len>_i;_i++)result=_ref[_i],resultSet.push(_thisBucket.objectWithJSON(result));if(null!=data.nextPaginationKey&&(nextQuery=jQuery.extend(!0,{},query),nextQuery.setPaginationKey(data.nextPaginationKey)),null!=callbacks)return callbacks.success(query,resultSet,nextQuery)}else if(null!=callbacks)return callbacks.failure(query,"Unable to parse response")},failure:function(error){return null!=callbacks?callbacks.failure(_thisBucket,error):void 0}},request.execute(executeCallbacks,!1)},KiiBucket.prototype["delete"]=function(callbacks){var executeCallbacks,request;return _thisBucket=this,request=this._getRequest({path:this._generatePath(),withApp:!0}),request.setMethod("DELETE"),executeCallbacks={success:function(){return null!=callbacks?callbacks.success(_thisBucket):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisBucket,error):void 0}},request.execute(executeCallbacks,!0)},KiiBucket._bucketWithName=function(bucketName,parent){var bucket;return bucket=new root.KiiBucket(bucketName,parent)},KiiBucket.prototype._getRequest=function(spec){var path,request,withApp;return path=spec.path,withApp=spec.withApp,request=new KiiRequest(path,withApp)},KiiBucket.prototype._generatePath=function(){var path;return path=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._bucketName:null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._bucketName:"/buckets/"+this._bucketName},KiiBucket.prototype.objectWithJSON=function(json){var newobject;return newobject=this.createObject(),newobject._updateWithJSON(json),newobject},KiiBucket}.call(this),root.KiiBucketAdmin=function(_super){function KiiBucketAdmin(bucketName,parent,token){this.acl=__bind(this.acl,this),this.createObjectWithType=__bind(this.createObjectWithType,this),this.createObject=__bind(this.createObject,this),this._getRequest=__bind(this._getRequest,this),KiiBucketAdmin.__super__.constructor.call(this,bucketName,parent),this._adminToken=token}var _adminToken;return __extends(KiiBucketAdmin,_super),_adminToken=null,KiiBucketAdmin.prototype._getRequest=function(spec){var request;return request=KiiBucketAdmin.__super__._getRequest.call(this,spec),request.setAdminToken(this._adminToken),request},KiiBucketAdmin.prototype.createObject=function(){return root.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},KiiBucketAdmin.prototype.createObjectWithType=function(type){return root.KiiObjectAdmin.objectWithBucket(this,type,this._adminToken)},KiiBucketAdmin.prototype.acl=function(){var acl;return acl=new root.KiiACLAdmin(this,this._adminToken)},KiiBucketAdmin}(root.KiiBucket),root.KiiGroup=function(){function KiiGroup(){this._setOwnerFromContext=__bind(this._setOwnerFromContext,this),this._userWithID=__bind(this._userWithID,this),this._getRequest=__bind(this._getRequest,this),this.getOwner=__bind(this.getOwner,this),this["delete"]=__bind(this["delete"],this),this.refresh=__bind(this.refresh,this),this.save=__bind(this.save,this),this.changeGroupName=__bind(this.changeGroupName,this),this._saveMembers=__bind(this._saveMembers,this),this.getMemberList=__bind(this.getMemberList,this),this._removeMember=__bind(this._removeMember,this),this._addMember=__bind(this._addMember,this),this.removeUser=__bind(this.removeUser,this),this.addUser=__bind(this.addUser,this),this.bucketWithName=__bind(this.bucketWithName,this),this.objectURI=__bind(this.objectURI,this),this._setOwner=__bind(this._setOwner,this),this.getCachedOwner=__bind(this.getCachedOwner,this),this._setName=__bind(this._setName,this),this.getName=__bind(this.getName,this),this._setUUID=__bind(this._setUUID,this),this.getUUID=__bind(this.getUUID,this),this._setAddMembers=__bind(this._setAddMembers,this),this._getRemoveMembers=__bind(this._getRemoveMembers,this),this._getAddMembers=__bind(this._getAddMembers,this),this._addMembers=[],this._removeMembers=[]}var _addMembers,_groupName,_owner,_removeMembers,_thisGroup;return _thisGroup=null,_groupName=null,_owner=null,_addMembers=null,_removeMembers=null,KiiGroup.prototype._getAddMembers=function(){return this._addMembers},KiiGroup.prototype._getRemoveMembers=function(){return this._removeMembers},KiiGroup.prototype._setAddMembers=function(members){var member,_i,_len,_results;if(null!=members){for(_results=[],_i=0,_len=members.length;_len>_i;_i++)member=members[_i],_results.push(this._addMembers.push(member));return _results}},KiiGroup.prototype.getUUID=function(){return this._uuid},KiiGroup.prototype._setUUID=function(_uuid){this._uuid=_uuid},KiiGroup.prototype.getName=function(){return this._groupName},KiiGroup.prototype._setName=function(_groupName){this._groupName=_groupName},KiiGroup.prototype.getCachedOwner=function(){return this._owner},KiiGroup.prototype._setOwner=function(_owner){this._owner=_owner},KiiGroup.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},KiiGroup.prototype.bucketWithName=function(bucketName){var bucket;return bucket=new root.KiiBucket(bucketName,this)},KiiGroup.prototype.addUser=function(member){var ndx;return $.inArray(member,-1===this._addMembers)&&this._addMembers.push(member),ndx=$.inArray(member,this._removeMembers),ndx>=0?KiiUtilities.arrayRemove(this._removeMembers,ndx,ndx):void 0},KiiGroup.prototype.removeUser=function(member){var ndx;return $.inArray(member,-1===this._removeMembers)&&this._removeMembers.push(member),ndx=$.inArray(member,this._addMembers),ndx>=0?KiiUtilities.arrayRemove(this._addMembers,ndx,ndx):void 0},KiiGroup.prototype._addMember=function(member,callback){var memberCallbacks,request;return _thisGroup=this,root.Kii.logger("Adding member "+member.getUUID()+" to group "+this._groupName),request=this._getRequest({path:"/groups/"+this._uuid+"/members/"+member.getUUID(),withApp:!0}),request.setMethod("PUT"),memberCallbacks={success:function(){var ndx;return ndx=$.inArray(member,_thisGroup._getAddMembers()),KiiUtilities.arrayRemove(_thisGroup._getAddMembers(),ndx,ndx),callback.success(_thisGroup)},failure:function(error){var ndx;return ndx=$.inArray(member,_thisGroup._getAddMembers()),KiiUtilities.arrayRemove(_thisGroup._getAddMembers(),ndx,ndx),callback.failure(_thisGroup,error)}},request.execute(memberCallbacks,!1)},KiiGroup.prototype._removeMember=function(member,callback){var removeCallbacks,request;return _thisGroup=this,root.Kii.logger("Removing member "+member.getUUID()+" to group "+this._groupName),request=this._getRequest({path:"/groups/"+this._uuid+"/members/"+member.getUUID(),withApp:!0}),request.setMethod("DELETE"),removeCallbacks={success:function(){var ndx;return ndx=$.inArray(member,_thisGroup._getRemoveMembers()),KiiUtilities.arrayRemove(_thisGroup._getRemoveMembers(),ndx,ndx),callback.success(_thisGroup)},failure:function(error){var ndx;return ndx=$.inArray(member,_thisGroup._getRemoveMembers()),KiiUtilities.arrayRemove(_thisGroup._getRemoveMembers(),ndx,ndx),callback.failure(_thisGroup,error)}},request.execute(removeCallbacks,!1)},KiiGroup.prototype.getMemberList=function(callbacks){var listCallbacks,request,_this=this;return _thisGroup=this,root.Kii.logger("Getting member list for group "+this._groupName),request=this._getRequest({path:"/groups/"+this._uuid+"/members",withApp:!0}),request.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),listCallbacks={success:function(data,statusCode){var member,memberList,members,_i,_len;if(300>statusCode&&statusCode>=200){for(memberList=[],members=data.members,_i=0,_len=members.length;_len>_i;_i++)member=members[_i],memberList.push(_this._userWithID(member.userID));if(null!=callbacks)return callbacks.success(_thisGroup,memberList)}else if(null!=callbacks)return callbacks.failure(_thisGroup,member,"Unable to get member list of group")},failure:function(error){return null!=callbacks?callbacks.failure(_thisGroup,error):void 0}},request.execute(listCallbacks,!1)},KiiGroup.prototype._saveMembers=function(callbacks){var member,_i,_j,_len,_len1,_ref,_ref1;for(_thisGroup=this,_ref=this._removeMembers,_i=0,_len=_ref.length;_len>_i;_i++)return member=_ref[_i],void this._removeMember(member,callbacks);for(_ref1=this._addMembers,_j=0,_len1=_ref1.length;_len1>_j;_j++)return member=_ref1[_j],void this._addMember(member,callbacks);return callbacks.success(_thisGroup)},KiiGroup.prototype.changeGroupName=function(newName,callbacks){var request,saveCallbacks;return _thisGroup=this,root.Kii.logger("Saving group: "+this.name),null!=this._uuid?(request=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),request.setContentType("text/plain"),request.setMethod("PUT"),request.setData(newName),saveCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if(_thisGroup._setName(newName),null!=callbacks)return callbacks.success(_thisGroup)}else if(null!=callbacks)return callbacks.failure(_thisGroup,"Unable to change group name - invalid response")},failure:function(error){return null!=callbacks?callbacks.failure(_thisGroup,error):void 0}},request.execute(saveCallbacks,!0)):callbacks.failure(_thisGroup,"Invalid group. Save the group on the server before updating the name.")},KiiGroup.prototype.save=function(callbacks){var data,request,saveCallbacks;return _thisGroup=this,root.Kii.logger("Saving group: "+this.name),null==this._uuid?(request=this._getRequest({path:"/groups",withApp:!0}),request.setContentType("application/vnd.kii.GroupCreationRequest+json"),request.setMethod("POST"),data={},null!=this._groupName&&(data.name=this._groupName),this._setOwnerFromContext(data),request.setData(data),saveCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200?(_thisGroup._setUUID(data.groupID),_thisGroup._saveMembers(callbacks)):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisGroup,error):void 0}},request.execute(saveCallbacks,!1)):this._saveMembers(callbacks)},KiiGroup.prototype.refresh=function(callbacks){var refreshCallbacks,request;return _thisGroup=this,root.Kii.logger("Refreshing group: "+this._groupName),request=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),request.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),refreshCallbacks={success:function(data){return _thisGroup=root.KiiGroup._groupWithJSON(data),null!=callbacks?callbacks.success(_thisGroup):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisGroup,error):void 0}},request.execute(refreshCallbacks,!1)},KiiGroup.prototype["delete"]=function(callbacks){var deleteCallbacks,request;return _thisGroup=this,root.Kii.logger("Deleting group: "+this._groupName),request=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),request.setMethod("DELETE"),deleteCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?callbacks.success(_thisGroup):null!=callbacks?callbacks.failure(_thisGroup,"Unable to parse response"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisGroup,error):void 0}},request.execute(deleteCallbacks,!0)},KiiGroup.prototype.getOwner=function(callbacks){return _thisGroup=this,root.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(group){return null!=callbacks?callbacks.success(group,group.getCachedOwner()):void 0},failure:function(group,error){return null!=callbacks?callbacks.failure(group,error):void 0}})},KiiGroup.groupWithName=function(groupName){return root.KiiGroup.groupWithNameAndMembers(groupName,null)},KiiGroup.groupWithNameAndMembers=function(groupName,members){var group;return group=new root.KiiGroup,group._setName(groupName),group._setAddMembers(members),group},KiiGroup.groupWithURI=function(uri){var compLength,components,group,newURI;if(group=null,newURI=uri.substr("kiicloud://".length),components=newURI.split("/"),compLength=components.length,!(compLength>0))throw new root.InvalidURIException;return group=new root.KiiGroup,group._setUUID(components[compLength-1]),group},KiiGroup._groupWithID=function(id){var group;return group=new root.KiiGroup,group._setUUID(id),group},KiiGroup._groupWithJSON=function(json){var group;return group=new root.KiiGroup,null!=json.groupID&&group._setUUID(json.groupID),null!=json.name&&group._setName(json.name),null!=json.owner&&group._setOwner(root.KiiUser._userWithID(json.owner)),group},KiiGroup.prototype._getRequest=function(spec){var path,request,withApp;return path=spec.path,withApp=spec.withApp,request=new KiiRequest(path,withApp)},KiiGroup.prototype._userWithID=function(id){var user;return user=root.KiiUser._userWithID(id)},KiiGroup.prototype._setOwnerFromContext=function(data){return null!=root.Kii.getCurrentUser()?(this._owner=root.Kii.getCurrentUser(),data.owner=this._owner.getUUID()):void 0},KiiGroup}.call(this),root.KiiObject=function(){function KiiObject(){this.moveBody=__bind(this.moveBody,this),this._parseObjectUri=__bind(this._parseObjectUri,this),this._userWithID=__bind(this._userWithID,this),this._getRequest=__bind(this._getRequest,this),this["delete"]=__bind(this["delete"],this),this.refresh=__bind(this.refresh,this),this.save=__bind(this.save,this),this.saveAllFields=__bind(this.saveAllFields,this),this._performSave=__bind(this._performSave,this),this._updateWithJSON=__bind(this._updateWithJSON,this),this.objectURI=__bind(this.objectURI,this),this.objectACL=__bind(this.objectACL,this),this.getGeoPoint=__bind(this.getGeoPoint,this),this.setGeoPoint=__bind(this.setGeoPoint,this),this.get=__bind(this.get,this),this.set=__bind(this.set,this),this._getPath=__bind(this._getPath,this),this._setBucket=__bind(this._setBucket,this),this.getBucket=__bind(this.getBucket,this),this._setObjectType=__bind(this._setObjectType,this),this.getObjectType=__bind(this.getObjectType,this),this._setModified=__bind(this._setModified,this),this.getModified=__bind(this.getModified,this),this._setCreated=__bind(this._setCreated,this),this.getCreated=__bind(this.getCreated,this),this._setUUID=__bind(this._setUUID,this),this.getUUID=__bind(this.getUUID,this),this._customInfo={}}var _bucket,_created,_customInfo,_modified,_objectType,_owner,_thisObject,_uuid;return _thisObject=null,KiiObject.prototype._alteredFields=[],_uuid=null,_created=null,_modified=null,_objectType=null,_customInfo=null,_bucket=null,_owner=null,KiiObject.prototype.getUUID=function(){return this._uuid},KiiObject.prototype._setUUID=function(_uuid){this._uuid=_uuid},KiiObject.prototype.getCreated=function(){return this._created},KiiObject.prototype._setCreated=function(_created){this._created=_created},KiiObject.prototype.getModified=function(){return this._modified},KiiObject.prototype._setModified=function(_modified){this._modified=_modified},KiiObject.prototype.getObjectType=function(){return this._objectType},KiiObject.prototype._setObjectType=function(_objectType){this._objectType=_objectType},KiiObject.prototype.getBucket=function(){return root.Kii.logger("GEtting bucket "+this._bucket),this._bucket},KiiObject.prototype._setBucket=function(_bucket){this._bucket=_bucket},KiiObject.prototype._getPath=function(){var path;return path=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":"/buckets/"+this._bucket.getBucketName()+"/objects/",null!=this._uuid&&(path+=this._uuid),path},KiiObject.prototype.set=function(key,value){return this._customInfo[key]=value,this._alteredFields.push(key)},KiiObject.prototype.get=function(key){return this._customInfo[key]},KiiObject.prototype.setGeoPoint=function(key,kiiGeoPoint){if(!(kiiGeoPoint instanceof KiiGeoPoint))throw InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[key]=kiiGeoPoint._toDict(),this._alteredFields.push(key)},KiiObject.prototype.getGeoPoint=function(key){var lat,lon,point;return point=this._customInfo[key],lat=point.lat,lon=point.lon,root.KiiGeoPoint.geoPoint(lat,lon)},KiiObject.prototype.objectACL=function(){return root.KiiACL.aclWithParent(this)},KiiObject.prototype.objectURI=function(){var base,uri;return base="kiicloud://",null!=this._bucket&&null!=this._uuid&&(uri=base,null!=this._bucket.getGroup()?uri+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()&&(uri+="users/"+this._bucket.getUser().getUUID()+"/"),uri+="buckets/"+this._bucket.getBucketName()+"/objects/"+this._uuid),uri},KiiObject.prototype._updateWithJSON=function(json){var key,val,_results;_results=[];for(key in json)val=json[key],"objectID"===key||"_id"===key||"uuid"===key?(root.Kii.logger("Setting uuid: "+val),_results.push(this._uuid=val)):_results.push("createdAt"===key||"_created"===key||"created"===key?this._created=val:"modifiedAt"===key||"_modified"===key||"modified"===key?this._modified=val:"_owner"===key?this._owner=this._userWithID(val):"_dataType"===key?this._objectType=val:"_calculated"===key?this._customInfo[key]=val:"_"!==key[0]?this._customInfo[key]=val:void 0);return _results},KiiObject.prototype._performSave=function(allFields,callbacks){var data,key,path,request,saveCallbacks,_i,_len,_ref;if(_thisObject=this,path=this._getPath(),request=new this._getRequest({path:path,withApp:!0}),request.setMethod(null!=this._uuid?"PUT":"POST"),data={},allFields)data=this._customInfo;else for(_ref=this._alteredFields,_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],data[key]=this._customInfo[key];return request.setData(data),null!=this._objectType&&request.setContentType("application/vnd."+root.Kii.getAppID()+"."+this._objectType+"+json"),null==this._uuid||allFields||(request.addHeader("X-HTTP-Method-Override","PATCH"),request.setMethod("POST")),saveCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if(_thisObject._updateWithJSON(data),_thisObject._alteredFields=[],null!=callbacks)return callbacks.success(_thisObject)
}else if(null!=callbacks)return callbacks.failure(_thisObject,"Unable to parse response")},failure:function(error){return null!=callbacks?callbacks.failure(_thisObject,error):void 0}},request.execute(saveCallbacks,!1)},KiiObject.prototype.saveAllFields=function(callbacks){return this._performSave(!0,callbacks)},KiiObject.prototype.save=function(callbacks){return this._performSave(!1,callbacks)},KiiObject.prototype.refresh=function(callbacks){var path,refreshCallbacks,request;return _thisObject=this,path=this._getPath(),request=new this._getRequest({path:path,withApp:!0}),refreshCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if(_thisObject._updateWithJSON(data),null!=callbacks)return callbacks.success(_thisObject)}else if(null!=callbacks)return callbacks.failure(_thisObject,"Unable to parse response")},failure:function(error){return null!=callbacks?callbacks.failure(_thisObject,error):void 0}},request.execute(refreshCallbacks,!1)},KiiObject.prototype["delete"]=function(callbacks){var path,refreshCallbacks,request;return _thisObject=this,path=this._getPath(),request=new this._getRequest({path:path,withApp:!0}),request.setMethod("DELETE"),refreshCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?callbacks.success(_thisObject):null!=callbacks?callbacks.failure(_thisObject,"Unable to parse response"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisObject,error):void 0}},request.execute(refreshCallbacks,!0)},KiiObject.objectWithBucket=function(bucket,type){var obj;return root.Kii.logger("Creating object w type: "+type),obj=new root.KiiObject,obj._setBucket(bucket),obj._setObjectType(type),root.Kii.logger(obj),obj},KiiObject.objectWithURI=function(uri){var bucket,bucketIndex,bucketName,compLength,components,group,newURI,obj,subject,user;if(newURI=uri.substr("kiicloud://".length),components=newURI.split("/"),compLength=components.length,root.Kii.logger(components),!(compLength>=4))throw new root.InvalidURIException;return bucketIndex=4===compLength?1:3,bucketName=components[bucketIndex],"groups"===components[0]?group=new root.KiiGroup._groupWithID(components[1]):"users"===components[0]&&(user=root.KiiUser._userWithID(components[1])),subject=null,null!=group?subject=group:null!=user&&(subject=user),bucket=new root.KiiBucket._bucketWithName(bucketName,subject),root.Kii.logger(bucket),obj=bucket.createObject(),obj._setUUID(components[compLength-1]),root.Kii.logger(obj),obj},KiiObject.prototype._getRequest=function(spec){var path,request,withApp;return path=spec.path,withApp=spec.withApp,request=new KiiRequest(path,withApp)},KiiObject.prototype._userWithID=function(id){var user;return user=root.KiiUser._userWithID(id)},KiiObject.prototype._parseObjectUri=function(uri){var data,targetData,uriElement,uriPrefix;return uriElement=uri.replace(/^kiicloud:\/\//g,"").split("/"),uriPrefix=uriElement[0],"users"===uriPrefix?(targetData={appID:root.Kii.getAppID(),userID:uriElement[1],type:"APP_AND_USER"},data={targetObjectScope:targetData,targetBucketID:uriElement[3],targetObjectID:uriElement[5]}):"groups"===uriPrefix?(targetData={appID:root.Kii.getAppID(),groupID:uriElement[1],type:"APP_AND_GROUP"},data={targetObjectScope:targetData,targetBucketID:uriElement[3],targetObjectID:uriElement[5]}):(targetData={appID:root.Kii.getAppID(),type:"APP"},data={targetObjectScope:targetData,targetBucketID:uriElement[1],targetObjectID:uriElement[3]}),data},KiiObject.prototype.moveBody=function(targetObjectUri,callbacks){var moveCallbacks,path,request,_sourceObject;if(_sourceObject=this,null==targetObjectUri)throw root.InvalidArgumentException("targetObjectUri is required");if(null==_sourceObject.getUUID())throw root.InvalidArgumentException("Source object is not saved on the cloud");return path=this._getPath()+"/body/move",request=new this._getRequest({path:path,withApp:!0}),request.setMethod("POST"),request.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json"),request.setData(this._parseObjectUri(targetObjectUri)),moveCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?callbacks.success(_sourceObject,targetObjectUri):null!=callbacks?callbacks.failure(_sourceObject,targetObjectUri,"Unable to parse response"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_sourceObject,targetObjectUri,error):void 0}},request.execute(moveCallbacks,!0)},KiiObject}.call(this),root.KiiQuery=function(){function KiiQuery(){this._dictValue=__bind(this._dictValue,this),this.sortByAsc=__bind(this.sortByAsc,this),this.sortByDesc=__bind(this.sortByDesc,this),this.setLimit=__bind(this.setLimit,this),this.getLimit=__bind(this.getLimit,this),this._setClause=__bind(this._setClause,this),this.setPaginationKey=__bind(this.setPaginationKey,this),this.getPaginationKey=__bind(this.getPaginationKey,this)}var _clause,_cursor,_limit,_paginationKey,_sortDescending,_sortField,_sortString;return _sortString=null,_cursor=null,_paginationKey=null,_sortDescending=!1,_sortField=null,_limit=25,_clause=null,KiiQuery.prototype.getPaginationKey=function(){return this._paginationKey},KiiQuery.prototype.setPaginationKey=function(_paginationKey){this._paginationKey=_paginationKey},KiiQuery.prototype._setClause=function(_clause){this._clause=_clause},KiiQuery.prototype.getLimit=function(){return this._limit},KiiQuery.prototype.setLimit=function(value){if(value>0)return this._limit=value;throw new root.InvalidLimitException},KiiQuery.queryWithClause=function(clause){var query;return query=new root.KiiQuery,query._setClause(clause),query},KiiQuery.prototype.sortByDesc=function(_sortField){return this._sortField=_sortField,this._sortDescending=!0},KiiQuery.prototype.sortByAsc=function(_sortField){return this._sortField=_sortField,this._sortDescending=!1},KiiQuery._emptyDictValue=function(){return{type:"all"}},KiiQuery.prototype._dictValue=function(){var data;return data={descending:this._sortDescending},data.clause=null!=this._clause?this._clause._getDictValue():root.KiiQuery._emptyDictValue(),null!=this._sortField&&(data.orderBy=this._sortField),data},KiiQuery}.call(this),root.KiiClause=function(){function KiiClause(){this._getDictValue=__bind(this._getDictValue,this),this._setDictValue=__bind(this._setDictValue,this),this._setWhereClauses=__bind(this._setWhereClauses,this),this._setWhereType=__bind(this._setWhereType,this)}var _dictExpression,_whereClauses,_whereType;return _dictExpression=null,_whereType=null,_whereClauses=null,KiiClause.constructor=function(){return KiiClause._whereClauses=[],KiiClause._dictExpression={}},KiiClause.prototype._setWhereType=function(_whereType){this._whereType=_whereType},KiiClause.prototype._setWhereClauses=function(_whereClauses){this._whereClauses=_whereClauses},KiiClause.prototype._setDictValue=function(_dictExpression){this._dictExpression=_dictExpression},KiiClause.prototype._getDictValue=function(){var clause,clauses,retDict,_i,_len,_ref;if(retDict={},null!=this._whereClauses&&null!=this._whereType)if(clauses=[],1===this._whereClauses.length)clause=this._whereClauses[0],retDict="not"===this._whereType?{type:this._whereType,clause:clause._getDictValue()}:clause._getDictValue();else{for(_ref=this._whereClauses,_i=0,_len=_ref.length;_len>_i;_i++)clause=_ref[_i],clauses.push(clause._getDictValue());retDict={type:this._whereType,clauses:clauses}}else null!=this._whereClauses?this._whereClauses.length>0&&(retDict=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(retDict=this._dictExpression);return null==retDict&&(retDict=root.KiiQuery.emptyDictValue()),retDict},KiiClause.createWithWhere=function(whereType,whereClauses){var expression;return expression=new root.KiiClause,expression._setWhereType(whereType),expression._setWhereClauses(whereClauses),expression},KiiClause.create=function(operator,key,value){var expression,_dict;return expression=new root.KiiClause,_dict={},"="===operator?(_dict.type="eq",_dict.field=key,_dict.value=value):"<"===operator?(_dict.type="range",_dict.field=key,_dict.upperLimit=value,_dict.upperIncluded=!1):"<="===operator?(_dict.type="range",_dict.field=key,_dict.upperLimit=value,_dict.upperIncluded=!0):">"===operator?(_dict.type="range",_dict.field=key,_dict.lowerLimit=value,_dict.lowerIncluded=!1):">="===operator?(_dict.type="range",_dict.field=key,_dict.lowerLimit=value,_dict.lowerIncluded=!0):"in"===operator?(_dict.type="in",_dict.field=key,_dict.values=value):"prefix"===operator&&(_dict.type="prefix",_dict.field=key,_dict.prefix=value),expression._setDictValue(_dict),expression},KiiClause.and=function(){return KiiClause.createWithWhere("and",arguments)},KiiClause.or=function(){return KiiClause.createWithWhere("or",arguments)},KiiClause.equals=function(key,value){return null!=value._className&&(value=value.objectURI),root.KiiClause.create("=",key,value)},KiiClause.notEquals=function(key,value){return null!=value._className&&(value=value.objectURI),root.KiiClause.createWithWhere("not",[root.KiiClause.equals(key,value)])},KiiClause.greaterThan=function(key,value){return root.KiiClause.create(">",key,value)},KiiClause.greaterThanOrEqual=function(key,value){return root.KiiClause.create(">=",key,value)},KiiClause.lessThan=function(key,value){return root.KiiClause.create("<",key,value)},KiiClause.lessThanOrEqual=function(key,value){return root.KiiClause.create("<=",key,value)},KiiClause["in"]=function(key,values){return root.KiiClause.create("in",key,values)},KiiClause.startsWith=function(key,value){return root.KiiClause.create("prefix",key,value)},KiiClause.geoDistance=function(key,center,radius,putDistanceInto){var expression,isValidGeoPoint,isValidString,pattern,_dict;if(isValidString=function(str){return"string"==typeof str&&str.length>0},isValidGeoPoint=function(point){return null==point?!1:point instanceof KiiGeoPoint},!isValidString(key))throw root.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!isValidGeoPoint(center))throw root.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(pattern="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=putDistanceInto&&!putDistanceInto.match(pattern))throw root.InvalidArgumentException("putDistanceInto is invalid.");if(0>=radius||radius>2e7||isNaN(radius))throw root.InvalidArgumentException("radius is invalid.");return expression=new root.KiiClause,_dict={},_dict.type="geodistance",_dict.field=key,center=center._toDict(),_dict.center=center,_dict.radius=radius,_dict.putDistanceInto=putDistanceInto,expression._setDictValue(_dict),expression},KiiClause.geoBox=function(key,northEast,southWest){var expression,isValidGeoPoint,isValidKey,ne,sw,_dict;if(isValidKey=function(key){return"string"==typeof key&&key.length>0},isValidGeoPoint=function(point){return null==point?!1:point instanceof KiiGeoPoint},!isValidKey(key))throw root.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!isValidGeoPoint(northEast)||!isValidGeoPoint(southWest))throw root.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");return expression=new root.KiiClause,_dict={},_dict.type="geobox",_dict.field=key,ne=northEast._toDict(),sw=southWest._toDict(),_dict.box={ne:ne,sw:sw},expression._setDictValue(_dict),expression},KiiClause}.call(this),KiiRequest=function(){function KiiRequest(path,withApp){this.execute=__bind(this.execute,this),this.setAdminToken=__bind(this.setAdminToken,this),this.addHeader=__bind(this.addHeader,this),this.setAccept=__bind(this.setAccept,this),this.getAccept=__bind(this.getAccept,this),this.setAnonymous=__bind(this.setAnonymous,this),this.isAnonymous=__bind(this.isAnonymous,this),this.setContentType=__bind(this.setContentType,this),this.getContentType=__bind(this.getContentType,this),this.setData=__bind(this.setData,this),this.getData=__bind(this.getData,this),this.setHeaders=__bind(this.setHeaders,this),this.getHeaders=__bind(this.getHeaders,this),this.setMethod=__bind(this.setMethod,this),this.getMethod=__bind(this.getMethod,this),this.setPath=__bind(this.setPath,this),this.getPath=__bind(this.getPath,this);_thisRequest=this,this._path=withApp?"/apps/"+root.Kii.getAppID()+path:path,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(){},this._failure=function(){}}var _adminToken,_thisRequest;return _thisRequest=null,KiiRequest._path=null,KiiRequest._method=null,KiiRequest._headers=null,KiiRequest._data=null,KiiRequest._contentType=null,KiiRequest._anonymous=!1,KiiRequest._accept=null,KiiRequest._success=null,KiiRequest._failure=null,_adminToken=null,KiiRequest.prototype.getPath=function(){return this._path},KiiRequest.prototype.setPath=function(_path){this._path=_path},KiiRequest.prototype.getMethod=function(){return this._method},KiiRequest.prototype.setMethod=function(_method){this._method=_method},KiiRequest.prototype.getHeaders=function(){return this._headers},KiiRequest.prototype.setHeaders=function(_headers){this._headers=_headers},KiiRequest.prototype.getData=function(){return this._data},KiiRequest.prototype.setData=function(_data){this._data=_data},KiiRequest.prototype.getContentType=function(){return this._contentType},KiiRequest.prototype.setContentType=function(_contentType){this._contentType=_contentType},KiiRequest.prototype.isAnonymous=function(){return this._anonymous},KiiRequest.prototype.setAnonymous=function(_anonymous){this._anonymous=_anonymous},KiiRequest.prototype.getAccept=function(){return this._accept},KiiRequest.prototype.setAccept=function(_accept){this._accept=_accept},KiiRequest.prototype.addHeader=function(name,value){return this._headers[name]=value},KiiRequest.prototype.setAdminToken=function(token){return this._adminToken=token},KiiRequest.prototype.execute=function(callbacks,ignoreBody){var ajaxData,json_text,key,postData,url,val,_ref;this._success=null!=callbacks.success?callbacks.success:this._success,this._failure=null!=callbacks.failure?callbacks.failure:this._failure,url=root.Kii.getBaseURL()+this._path,root.Kii.logger("POSTING: "),root.Kii.logger(this._data),null!=this._data&&(postData={}),_ref=this._data;for(key in _ref)val=_ref[key],postData[key]=encodeURIComponent(val);return json_text=JSON.stringify(this._data),root.Kii.logger("Making request["+this._method+"] to "+url+" with data: "+json_text),this._headers["x-kii-appid"]=root.Kii.getAppID(),this._headers["x-kii-appkey"]=root.Kii.getAppKey(),this._headers["x-kii-sdk"]=root.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==root.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+root.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),root.Kii.logger("Headers: "),root.Kii.logger(this._headers),$.support.cors=!0,ajaxData={type:this._method,url:url,dataType:"json",headers:this._headers,contentType:this._contentType,error:function(xhr,status,error){var errString,json;errString=error?error:status+" : "+url;try{json=jQuery.parseJSON(decodeURIComponent(xhr.responseText))}catch(_error){error=_error,json=null}return null!=json&&null!=json.errorCode&&(errString=json.errorCode,null!=json.message&&(errString+=": "+json.message)),root.Kii.logger("Failure: "+errString),root.Kii.logger(xhr.responseText),_thisRequest._failure(errString,xhr.status)},success:function(data,status,xhr){var e,errString,json;if(root.Kii.logger("Completed Request["+xhr.status+"]"),root.Kii.logger(xhr.responseText),ignoreBody)return _thisRequest._success(null,xhr.status);try{json=jQuery.parseJSON(xhr.responseText)}catch(_error){e=_error,json=null}return null!=json?null!=json.errorCode?(errString=json.errorCode,null!=json.message&&(errString+=": "+json.message),_thisRequest._failure(errString,xhr.status,json.errorCode)):_thisRequest._success(json,xhr.status):_thisRequest._success(null,xhr.status,null)}},"GET"!==this._method&&null!=json_text&&(ajaxData.data=json_text,ajaxData.processData=!1),$.ajax(ajaxData)},KiiRequest}(),root.KiiUser=function(){function KiiUser(){this._getRequest=__bind(this._getRequest,this),this._updateWithJSON=__bind(this._updateWithJSON,this),this["delete"]=__bind(this["delete"],this),this.refresh=__bind(this.refresh,this),this.save=__bind(this.save,this),this.changeEmail=__bind(this.changeEmail,this),this.changePhone=__bind(this.changePhone,this),this.ownerOfGroups=__bind(this.ownerOfGroups,this),this.memberOfGroups=__bind(this.memberOfGroups,this),this.resendPhoneNumberVerification=__bind(this.resendPhoneNumberVerification,this),this.resendEmailVerification=__bind(this.resendEmailVerification,this),this.resendVerification=__bind(this.resendVerification,this),this.verifyPhoneNumber=__bind(this.verifyPhoneNumber,this),this.verifyCredentials=__bind(this.verifyCredentials,this),this.updatePassword=__bind(this.updatePassword,this),this.register=__bind(this.register,this),this._authenticateWithToken=__bind(this._authenticateWithToken,this),this._authenticate=__bind(this._authenticate,this),this.bucketWithName=__bind(this.bucketWithName,this),this.get=__bind(this.get,this),this.set=__bind(this.set,this),this.objectURI=__bind(this.objectURI,this),this._setAccessToken=__bind(this._setAccessToken,this),this.getAccessToken=__bind(this.getAccessToken,this),this._setPhoneVerified=__bind(this._setPhoneVerified,this),this.getPhoneVerified=__bind(this.getPhoneVerified,this),this._setEmailVerified=__bind(this._setEmailVerified,this),this.getEmailVerified=__bind(this.getEmailVerified,this),this._setModified=__bind(this._setModified,this),this.getModified=__bind(this.getModified,this),this._setCreated=__bind(this._setCreated,this),this.getCreated=__bind(this.getCreated,this),this.setCountry=__bind(this.setCountry,this),this.getCountry=__bind(this.getCountry,this),this._setPassword=__bind(this._setPassword,this),this._setPhoneNumber=__bind(this._setPhoneNumber,this),this.getPhoneNumber=__bind(this.getPhoneNumber,this),this._setEmailAddress=__bind(this._setEmailAddress,this),this.getEmailAddress=__bind(this.getEmailAddress,this),this._validateDisplayName=__bind(this._validateDisplayName,this),this.setDisplayName=__bind(this.setDisplayName,this),this.getDisplayName=__bind(this.getDisplayName,this),this._setUsername=__bind(this._setUsername,this),this.getUsername=__bind(this.getUsername,this),this._setUUID=__bind(this._setUUID,this),this.getUUID=__bind(this.getUUID,this),this._customInfo={}}var _accessToken,_country,_created,_customInfo,_displayName,_emailAddress,_emailVerified,_modified,_password,_phoneNumber,_phoneVerified,_thisUser,_username,_uuid;return _thisUser=null,_uuid=null,_username=null,_displayName=null,_password=null,_emailAddress=null,_phoneNumber=null,_country=null,_created=null,_modified=null,_emailVerified=null,_phoneVerified=null,_accessToken=null,_customInfo=null,KiiUser.prototype.getUUID=function(){return this._uuid},KiiUser.prototype._setUUID=function(_uuid){this._uuid=_uuid},KiiUser.prototype.getUsername=function(){return this._username},KiiUser.prototype._setUsername=function(value){if(root.Kii.logger("Setting username: "+value),KiiUtilities._validateUsername(value))return this._username=$.trim(value);throw new root.InvalidUsernameException},KiiUser.prototype.getDisplayName=function(){return this._displayName},KiiUser.prototype.setDisplayName=function(value){return this._validateDisplayName(value),this._displayName=value},KiiUser.prototype._validateDisplayName=function(value){if(typeof value===!1)throw new root.InvalidDisplayNameException;if(4>value.length||value.length>50)throw new root.InvalidDisplayNameException},KiiUser.prototype.getEmailAddress=function(){return this._emailAddress},KiiUser.prototype._setEmailAddress=function(value){if(root.Kii.logger("Setting email: "+value),KiiUtilities._validateEmail(value))return this._emailAddress=$.trim(value);throw new root.InvalidEmailException},KiiUser.prototype.getPhoneNumber=function(){return this._phoneNumber},KiiUser.prototype._setPhoneNumber=function(value){if(root.Kii.logger("Setting phone number: "+value),KiiUtilities._validatePhoneNumber(value))return this._phoneNumber=value;throw new root.InvalidPhoneNumberException},KiiUser.prototype._setPassword=function(value){if(KiiUtilities._validatePassword(value))return this._password=value;throw new root.InvalidPasswordException},KiiUser.prototype.getCountry=function(){return this._country},KiiUser.prototype.setCountry=function(value){if(KiiUtilities._validateCountryCode(value))return this._country=value;throw new root.InvalidCountryException},KiiUser.prototype.getCreated=function(){return this._created},KiiUser.prototype._setCreated=function(_created){this._created=_created},KiiUser.prototype.getModified=function(){return this._modified},KiiUser.prototype._setModified=function(_modified){this._modified=_modified},KiiUser.prototype.getEmailVerified=function(){return this._emailVerified},KiiUser.prototype._setEmailVerified=function(_emailVerified){this._emailVerified=_emailVerified},KiiUser.prototype.getPhoneVerified=function(){return this._phoneVerified},KiiUser.prototype._setPhoneVerified=function(_phoneVerified){this._phoneVerified=_phoneVerified},KiiUser.prototype.getAccessToken=function(){return root.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},KiiUser.prototype._setAccessToken=function(_accessToken){return this._accessToken=_accessToken,root.Kii.logger("Setting access token: "+this._accessToken)},KiiUser.prototype.objectURI=function(){var uri;return null!=this._uuid&&(uri="kiicloud://users/"+this._uuid),uri},KiiUser.prototype.set=function(key,value){return root.Kii.logger(this),root.Kii.logger(this._customInfo),this._customInfo[key]=value},KiiUser.prototype.get=function(key){return this._customInfo[key]},KiiUser.getCurrentUser=function(){return root.Kii.getCurrentUser()},KiiUser.userWithUsername=function(username,password){var user;return user=new root.KiiUser,user._setUsername(username),user._setPassword(password),user},KiiUser._userWithEmailAddress=function(emailAddress,password){var user;return user=new root.KiiUser,user._setEmailAddress(emailAddress),user._setPassword(password),user},KiiUser._userWithPhoneNumber=function(phoneNumber,password){var user;return user=new root.KiiUser,user._setPhoneNumber(phoneNumber),user._setPassword(password),user},KiiUser.userWithPhoneNumber=function(phoneNumber,password){var user;return user=new root.KiiUser,user._setPhoneNumber(phoneNumber),user._setPassword(password),user},KiiUser.userWithPhoneNumberAndUsername=function(phoneNumber,username,password){var user;return user=new root.KiiUser,user._setPhoneNumber(phoneNumber),user._setUsername(username),user._setPassword(password),user},KiiUser.userWithEmailAddress=function(emailAddress,password){var user;return user=new root.KiiUser,user._setEmailAddress(emailAddress),user._setPassword(password),user},KiiUser.userWithEmailAddressAndUsername=function(emailAddress,username,password){var user;return user=new root.KiiUser,user._setEmailAddress(emailAddress),user._setUsername(username),user._setPassword(password),user},KiiUser.userWithEmailAddressAndPhoneNumber=function(emailAddress,phoneNumber,password){var user;return user=new root.KiiUser,user._setEmailAddress(emailAddress),user._setPhoneNumber(phoneNumber),user._setPassword(password),user},KiiUser.userWithCredentials=function(emailAddress,phoneNumber,username,password){var user;return user=new root.KiiUser,user._setEmailAddress(emailAddress),user._setPhoneNumber(phoneNumber),user._setUsername(username),user._setPassword(password),user},KiiUser._validateURI=function(value){var match,pattern,retValue;return value=$.trim(value),pattern=/^kiicloud:\/\/users\/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})$/i,"string"===(typeof value).toLowerCase()&&(match=value.match(pattern),null!=match&&(retValue=match[1])),retValue},KiiUser.userWithURI=function(uri){var user,uuid;if(root.Kii.logger("About to extract from: "+uri),uuid=root.KiiUser._validateURI(uri),root.Kii.logger("Extracted uuid from uri: "+uuid),null==uuid)throw new root.InvalidURIException;return user=new root.KiiUser,user._setUUID(uuid),user},KiiUser._userWithID=function(id){var user;return user=new root.KiiUser,user._setUUID(id),user},KiiUser.prototype.bucketWithName=function(bucketName){return new root.KiiBucket._bucketWithName(bucketName,this)},KiiUser.prototype._authenticate=function(callbacks){var authCallbacks,request,username;return _thisUser=this,root.Kii.logger("Authenticating user:"),root.Kii.logger(this),root.Kii.logger("Email verified: "+this._emailVerified),root.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?username=this._username:null!=this._emailAddress&&this._emailVerified===!0?username=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?username=this._phoneNumber:null!=this._emailAddress?username=this._emailAddress:null!=this._phoneNumber&&(username=this._phoneNumber),request=this._getRequest({path:"/oauth2/token",withApp:!1}),request.setAnonymous(!0),request.setMethod("POST"),request.setData({username:username,password:this._password}),authCallbacks={success:function(data){return _thisUser._setUUID(data.id),_thisUser._setAccessToken(data.access_token),root.Kii.setCurrentUser(_thisUser),null!=callbacks?callbacks.success(root.Kii.getCurrentUser()):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(authCallbacks,!1)},KiiUser.prototype._authenticateWithToken=function(token,callbacks){var authCallbacks,request;return _thisUser=this,root.Kii.logger("Authenticating user "+this),root.Kii.logger(callbacks),request=this._getRequest({path:"/users/me",withApp:!0}),request.setAnonymous(!0),request.addHeader("Authorization","Bearer "+token),authCallbacks={success:function(data){return _thisUser._updateWithJSON(data),_thisUser._setAccessToken(token),root.Kii.setCurrentUser(_thisUser),null!=callbacks?callbacks.success(root.Kii.getCurrentUser()):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(authCallbacks,!1)},KiiUser.authenticate=function(userIdentifier,password,callbacks){var error,user;try{if(root.Kii.logger("UserIdentifier: "+userIdentifier),!KiiUtilities._validatePassword(password))throw new root.InvalidPasswordException;if(KiiUtilities._validateEmail(userIdentifier))user=root.KiiUser._userWithEmailAddress(userIdentifier,password);else if(KiiUtilities._validatePhoneNumber(userIdentifier))user=root.KiiUser._userWithPhoneNumber(userIdentifier,password);else{if(!KiiUtilities._validateUsername(userIdentifier))throw new root.InvalidUserIdentifierException;user=root.KiiUser.userWithUsername(userIdentifier,password)}return user._authenticate(callbacks)}catch(_error){if(error=_error,null!=callbacks)return callbacks.failure(null,error.message)}},KiiUser.authenticateWithToken=function(token,callbacks){var user;return user=new root.KiiUser,user._authenticateWithToken(token,callbacks)},KiiUser.prototype.register=function(callbacks){var data,key,registrationCallbacks,request,value,_ref;_thisUser=this,root.Kii.logger("Registering user "+this),data={password:this._password},null!=this._username&&(data.loginName=this._username),null!=this._displayName&&(data.displayName=this._displayName),null!=this._emailAddress&&(data.emailAddress=this._emailAddress),null!=this._phoneNumber&&(data.phoneNumber=this._phoneNumber),null!=this._country&&(data.country=this._country),root.Kii.logger("CINFO"),root.Kii.logger(this._customInfo),_ref=this._customInfo;for(key in _ref)value=_ref[key],root.Kii.logger("Key/val: "+key+"/"+value),data[key]=value;return request=this._getRequest({path:"/users",withApp:!0}),request.setMethod("POST"),request.setData(data),request.setAnonymous(!0),request.setContentType("application/vnd.kii.RegistrationRequest+json"),registrationCallbacks={success:function(data){return root.Kii.logger("Succreg"),_thisUser._updateWithJSON(data),_thisUser._authenticate(callbacks)},failure:function(error){return root.Kii.logger("Failreg"),null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(registrationCallbacks,!1)},KiiUser.prototype.updatePassword=function(fromPassword,toPassword,callbacks){var data,path,request,updateCallbacks;return _thisUser=this,root.Kii.logger("Updating password from "+fromPassword+" to "+toPassword),KiiUtilities._validatePassword(toPassword)?(data={oldPassword:fromPassword,newPassword:toPassword},path="/users/"+this._uuid+"/password",request=this._getRequest({path:path,withApp:!0}),request.setMethod("PUT"),request.setData(data),request.setContentType("application/vnd.kii.ChangePasswordRequest+json"),updateCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if(_thisUser._setPassword(toPassword),null!=callbacks)return callbacks.success(_thisUser)}else if(null!=callbacks)return callbacks.failure(_thisUser,"Unable to change password")},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(updateCallbacks,!0)):null!=callbacks?callbacks.failure(_thisUser,(new root.InvalidPasswordException).message):void 0},KiiUser.resetPassword=function(userIdentifier,callbacks){var accountType,path,request,resetCallbacks;if(root.Kii.logger("Resetting password with identifier: "+userIdentifier),KiiUtilities._validateEmail(userIdentifier))accountType="EMAIL";else if(null!=callbacks)return void callbacks.failure("Invalid user identifier. Must be a valid email address");return null!=accountType?(path="/users/"+accountType+":"+userIdentifier+"/password/request-reset",request=new KiiRequest(path,!0),request.setMethod("POST"),request.setAnonymous(!0),resetCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?callbacks.success():null!=callbacks?callbacks.failure("Unable to reset password"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(error):void 0}},request.execute(resetCallbacks,!0)):void 0},KiiUser.prototype.verifyCredentials=function(type,code,callbacks){var path,request,verifyCallbacks;return _thisUser=this,root.Kii.logger("Verifying "+type+" with code: "+code),path="/users/me/"+type+"/verify",request=this._getRequest({path:path,withApp:!0}),request.setMethod("POST"),request.setData({verificationCode:code}),request.setContentType("application/vnd.kii.AddressVerificationRequest+json"),verifyCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if("email-address"===type?_thisUser._setEmailVerified(!0):"phone-number"===type&&_thisUser._setPhoneVerified(!0),null!=callbacks)return callbacks.success(_thisUser)}else if(null!=callbacks)return callbacks.failure(_thisUser,"Unable to verify "+type)},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(verifyCallbacks,!0)},KiiUser.prototype.verifyPhoneNumber=function(verificationCode,callbacks){return this.verifyCredentials("phone-number",verificationCode,callbacks)},KiiUser.prototype.resendVerification=function(type,callbacks){var path,request,resendCallbacks;return _thisUser=this,root.Kii.logger("Resending verification "+type),path="/users/me/"+type+"/resend-verification",request=this._getRequest({path:path,withApp:!0}),request.setMethod("POST"),resendCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?callbacks.success(_thisUser):null!=callbacks?callbacks.failure(_thisUser,"Unable to resend "+type+" verification"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(resendCallbacks,!0)},KiiUser.prototype.resendEmailVerification=function(callbacks){return this.resendVerification("email-address",callbacks)},KiiUser.prototype.resendPhoneNumberVerification=function(callbacks){return this.resendVerification("phone-number",callbacks)
},KiiUser.prototype.memberOfGroups=function(callbacks){var memberCallbacks,path,request;return _thisUser=this,root.Kii.logger("Getting groups for member "+this._uuid),path="/groups/?is_member="+this._uuid,request=this._getRequest({path:path,withApp:!0}),request.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),memberCallbacks={success:function(data,statusCode){var group,groupList,_i,_len,_ref;if(300>statusCode&&statusCode>=200){for(groupList=[],_ref=data.groups,_i=0,_len=_ref.length;_len>_i;_i++)group=_ref[_i],groupList.push(root.KiiGroup._groupWithJSON(group));if(null!=callbacks)return callbacks.success(_thisUser,groupList)}else if(null!=callbacks)return callbacks.failure(_thisUser,"Unable to retrieve groups")},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(memberCallbacks,!1)},KiiUser.prototype.ownerOfGroups=function(callbacks){var memberCallbacks,path,request;return _thisUser=this,root.Kii.logger("Getting groups owned by the user "+this._uuid),path="/groups/?owner="+this._uuid,request=this._getRequest({path:path,withApp:!0}),request.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),memberCallbacks={success:function(data,statusCode){var group,groupList,_i,_len,_ref;if(300>statusCode&&statusCode>=200){for(groupList=[],_ref=data.groups,_i=0,_len=_ref.length;_len>_i;_i++)group=_ref[_i],groupList.push(root.KiiGroup._groupWithJSON(group));if(null!=callbacks)return callbacks.success(_thisUser,groupList)}else if(null!=callbacks)return callbacks.failure(_thisUser,"Unable to retrieve groups")},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(memberCallbacks,!1)},KiiUser.prototype.changePhone=function(newPhoneNumber,callbacks){var path,request,updateCallbacks;return _thisUser=this,root.Kii.logger("Updating phone number to "+newPhoneNumber),path="/users/"+this._uuid+"/phone-number",request=this._getRequest({path:path,withApp:!0}),request.setMethod("PUT"),request.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),request.setData({phoneNumber:newPhoneNumber}),updateCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?(_thisUser._setPhoneVerified(!1),_thisUser._setPhoneNumber(newPhoneNumber),callbacks.success(_thisUser)):null!=callbacks?callbacks.failure(_thisUser,"Unable to update phone number"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(updateCallbacks,!0)},KiiUser.prototype.changeEmail=function(newEmail,callbacks){var path,request,updateCallbacks;return _thisUser=this,root.Kii.logger("Updating email address to: "+newEmail),KiiUtilities._validateEmail(newEmail)?(path="/users/"+this._uuid+"/email-address",request=this._getRequest({path:path,withApp:!0}),request.setMethod("PUT"),request.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),request.setData({emailAddress:newEmail}),updateCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?(_thisUser._setEmailVerified(!1),_thisUser._setEmailAddress(newEmail),callbacks.success(_thisUser)):null!=callbacks?callbacks.failure(_thisUser,"Unable to update email address"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(updateCallbacks,!0)):callbacks.failure(_thisUser,"Invalid email address format")},KiiUser.prototype.save=function(callbacks){var data,path,request,updateCallbacks;return _thisUser=this,root.Kii.logger("Saving user: "+this._uuid),path="/users/"+this._uuid,root.Kii.logger("CUSTOMINFO: "),root.Kii.logger(this._customInfo),request=this._getRequest({path:path,withApp:!0}),request.setMethod("POST"),request.setContentType("application/vnd.kii.UserUpdateRequest+json"),data=this._customInfo,null!=this._country&&(data.country=this._country),null!=this._displayName&&(data.displayName=this._displayName),request.setData(data),updateCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if(_thisUser._setModified(data.modifiedAt),null!=callbacks)return callbacks.success(_thisUser)}else if(null!=callbacks)return callbacks.failure(_thisUser,"Unable to parse response")},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(updateCallbacks,!1)},KiiUser.prototype.refresh=function(callbacks){var refreshCallbacks,request;return _thisUser=this,root.Kii.logger("Refreshing user: "+this._uuid),request=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),refreshCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if(_thisUser._updateWithJSON(data),null!=callbacks)return callbacks.success(_thisUser)}else if(null!=callbacks)return callbacks.failure(_thisUser,"Unable to parse response")},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(refreshCallbacks,!1)},KiiUser.prototype["delete"]=function(callbacks){var refreshCallbacks,request;return root.Kii.logger("Deleting user..."),_thisUser=this,request=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),request.setMethod("DELETE"),refreshCallbacks={success:function(data,statusCode){return 300>statusCode&&statusCode>=200&&null!=callbacks?callbacks.success(_thisUser):null!=callbacks?callbacks.failure(_thisUser,"Unable to parse response"):void 0},failure:function(error){return null!=callbacks?callbacks.failure(_thisUser,error):void 0}},request.execute(refreshCallbacks,!0)},KiiUser.logOut=function(){return root.Kii.logOut()},KiiUser.loggedIn=function(){return root.Kii.loggedIn()},KiiUser.getCurrentUser=function(){return root.Kii.getCurrentUser()},KiiUser.prototype._updateWithJSON=function(json){var key,value;root.Kii.logger("Updating with:"),root.Kii.logger(json);for(key in json)value=json[key],root.Kii.logger("key/val => "+key+"/"+value),root.Kii.logger("Substr "+key.substring(0,1)),"userID"===key||"id"===key?this._uuid=value:"created"===key||"createdAt"===key||"_created"===key?this._created=value:"modified"===key||"modifiedAt"===key||"_modified"===key?this._modified=value:"loginName"===key?this._username=value:"displayName"===key?this._displayName=value:"country"===key?(root.Kii.logger("Is setting country"),this._country=value):"emailAddress"===key?this._emailAddress=value:"phoneNumber"===key?this._phoneNumber=value:"emailAddressVerified"===key?(root.Kii.logger("Email verified: "+value),this._emailVerified=value):"phoneNumberVerified"===key?(root.Kii.logger("Phone verified: "+value),this._phoneVerified=value):""===key?(root.Kii.logger("Setting empty to custom info"),this._customInfo[key]=value):key.substring(0,!0)?(root.Kii.logger("Setting to custom info"),this._customInfo[key]=value):root.Kii.logger("Doing nothing");return null==this._displayName&&null!=this._username?this._displayName=this._username:void 0},KiiUser.prototype._getRequest=function(spec){var path,request,withApp;return path=spec.path,withApp=spec.withApp,request=new KiiRequest(path,withApp)},KiiUser}.call(this),KiiUtilities=function(){function KiiUtilities(){}return KiiUtilities.arrayRemove=function(array,from,to){var rest;return rest=array.slice((to||from)+1||array.length),array.length=0>from?array.length+from:from,array.push.apply(array,rest)},KiiUtilities._validateEmail=function(value){var pattern;return value=$.trim(value),pattern=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i,"string"!==(typeof value).toLowerCase()?(root.Kii.logger("Not string"),!1):value.match(pattern)?!0:!1},KiiUtilities._validatePhoneNumber=function(value){var pattern;return value=$.trim(value),pattern=/^[\\+]+[0-9]{10,}$/i,"string"!==(typeof value).toLowerCase()?(root.Kii.logger("Not string"),!1):value.match(pattern)?!0:!1},KiiUtilities._validateLocalPhone=function(value){var pattern;return value=$.trim(value),pattern=/^\d+$/,"string"!==(typeof value).toLowerCase()?(root.Kii.logger("Not string"),!1):value.match(pattern)?!0:(root.Kii.logger("Invalid format"),!1)},KiiUtilities._assertLocalPhoneIsValid=function(value){if(!KiiUtilities._validateLocalPhone(value))throw new root.InvalidLocalPhoneNumberException},KiiUtilities._validateCountryCode=function(value){var pattern;return value=$.trim(value),pattern=/^[a-z]{2}$/i,"string"!==(typeof value).toLowerCase()?(root.Kii.logger("Not string"),!1):value.match(pattern)?(root.Kii.logger("Is true"),!0):!1},KiiUtilities._assertCountryCodeIsValid=function(value){if(!KiiUtilities._validateCountryCode(value))throw new root.InvalidCountryException},KiiUtilities._validatePassword=function(value){var pattern;return root.Kii.logger("Validating password: "+value),pattern=/^[ -~]{4,50}$/,"string"!==(typeof value).toLowerCase()?(root.Kii.logger("not string"),!1):value.match(pattern)?(root.Kii.logger("matched"),!0):(root.Kii.logger("other exception"),!1)},KiiUtilities._assertPasswordIsValid=function(value){if(!KiiUtilities._validatePassword(value))throw new root.InvalidPasswordException},KiiUtilities._validateUsername=function(value){var pattern;return pattern=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof value).toLowerCase()?!1:value.match(pattern)?!0:!1},KiiUtilities}.call(this),root.KiiSocialConnect=function(){function KiiSocialConnect(){}var _instance;return _instance=null,KiiSocialConnect.setupNetwork=function(networkName,apiKey,apiSecret,extras){var manager;return null==_instance&&(_instance=new _KiiSocialConnect),manager=_instance._getManager(networkName),manager._reset(),manager._setup(apiKey,apiSecret,extras),root.Kii.logger("Set key: "+manager._key)},KiiSocialConnect.logIn=function(networkName,options,callbacks){var called;return called=!1,null!=_instance&&(root.Kii.logger("And manager: "),root.Kii.logger(_instance._getManager(networkName)),_instance._getManager(networkName)&&(_instance._getManager(networkName)._logIn(options,callbacks),called=!0)),root.Kii.logger("Callbacks"),root.Kii.logger(callbacks),called||null==callbacks?void 0:callbacks.failure(root.KiiUser.getCurrentUser(),networkName,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},KiiSocialConnect.linkCurrentUserWithNetwork=function(networkName,options,callbacks){var called;return root.Kii.logger("Trying with instance"),root.Kii.logger(_instance),called=!1,null!=_instance&&(root.Kii.logger("And manager: "),root.Kii.logger(_instance._getManager(networkName)),_instance._getManager(networkName)&&(_instance._getManager(networkName)._linkWithCurrentUser(options,callbacks),called=!0)),root.Kii.logger("Callbacks"),root.Kii.logger(callbacks),called||null==callbacks?void 0:callbacks.failure(root.KiiUser.getCurrentUser(),networkName,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},KiiSocialConnect.unLinkCurrentUserFromNetwork=function(networkName,callbacks){if(root.Kii.logger("Trying with instance"),root.Kii.logger(_instance),null!=_instance){if(root.Kii.logger("And manager: "),root.Kii.logger(_instance._getManager(networkName)),_instance._getManager(networkName))return _instance._getManager(networkName)._unlinkFromCurrentUser(callbacks)}else if(null!=callbacks)return callbacks.failure(root.KiiUser.getCurrentUser(),networkName,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},KiiSocialConnect.getAccessTokenForNetwork=function(networkName){return _instance._getManager(networkName)._getToken()},KiiSocialConnect.getAccessTokenExpirationForNetwork=function(networkName){return _instance._getManager(networkName)._getTokenExpiration()},KiiSocialConnect.getAccessTokenObjectForNetwork=function(networkName){return _instance._getManager(networkName)._getTokenObject()},KiiSocialConnect.logOutAll=function(){var fb,tw;return null!=_instance&&(fb=_instance._getManager(root.KiiSocialNetworkName.FACEBOOK),null!=fb&&fb._logOut(),tw=_instance._getManager(root.KiiSocialNetworkName.TWITTER),null!=tw)?tw._logOut():void 0},KiiSocialConnect}.call(this),_KiiSocialConnect=function(){function _KiiSocialConnect(){this._getManager=__bind(this._getManager,this)}var _facebookManager,_twitterManager;return _facebookManager=null,_twitterManager=null,_KiiSocialConnect.prototype._getManager=function(networkName){return networkName===root.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new root.KiiSCNFacebook:networkName===root.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new root.KiiSCNTwitter:void 0},_KiiSocialConnect}(),root.KiiSocialConnectNetwork=function(){function KiiSocialConnectNetwork(_network){this._network=_network,this._setup=__bind(this._setup,this),this._unlinkFromCurrentUser=__bind(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=__bind(this._linkWithCurrentUser,this),this._logOut=__bind(this._logOut,this),this._logIn=__bind(this._logIn,this),this._reset=__bind(this._reset,this),this._isAuthenticated=__bind(this._isAuthenticated,this),this._getCallbacks=__bind(this._getCallbacks,this),this._setCallbacks=__bind(this._setCallbacks,this),this._getTokenObject=__bind(this._getTokenObject,this),this._setTokenObject=__bind(this._setTokenObject,this),this._getTokenExpiration=__bind(this._getTokenExpiration,this),this._setTokenExpiration=__bind(this._setTokenExpiration,this),this._getToken=__bind(this._getToken,this),this._setToken=__bind(this._setToken,this),this._getExtras=__bind(this._getExtras,this),this._setExtras=__bind(this._setExtras,this),this._getSecret=__bind(this._getSecret,this),this._setSecret=__bind(this._setSecret,this),this._getKey=__bind(this._getKey,this),this._setKey=__bind(this._setKey,this),this._getNetwork=__bind(this._getNetwork,this),this._setNetwork=__bind(this._setNetwork,this)}var _callbacks,_extras,_key,_network,_secret,_token,_tokenExpiration,_tokenObject;return KiiSocialConnectNetwork.prototype._className="KiiSocialConnectNetwork",_network=null,_key=null,_secret=null,_extras=null,_token=null,_tokenExpiration=null,_tokenObject=null,_callbacks=null,KiiSocialConnectNetwork.prototype._setNetwork=function(_network){this._network=_network},KiiSocialConnectNetwork.prototype._getNetwork=function(){return this._network},KiiSocialConnectNetwork.prototype._setKey=function(_key){this._key=_key},KiiSocialConnectNetwork.prototype._getKey=function(){return this._key},KiiSocialConnectNetwork.prototype._setSecret=function(_secret){this._secret=_secret},KiiSocialConnectNetwork.prototype._getSecret=function(){return this._secret},KiiSocialConnectNetwork.prototype._setExtras=function(_extras){this._extras=_extras},KiiSocialConnectNetwork.prototype._getExtras=function(){return this._extras},KiiSocialConnectNetwork.prototype._setToken=function(_token){this._token=_token},KiiSocialConnectNetwork.prototype._getToken=function(){return this._token},KiiSocialConnectNetwork.prototype._setTokenExpiration=function(_tokenExpiration){this._tokenExpiration=_tokenExpiration},KiiSocialConnectNetwork.prototype._getTokenExpiration=function(){return this._tokenExpiration},KiiSocialConnectNetwork.prototype._setTokenObject=function(_tokenObject){this._tokenObject=_tokenObject},KiiSocialConnectNetwork.prototype._getTokenObject=function(){return this._tokenObject},KiiSocialConnectNetwork.prototype._setCallbacks=function(_callbacks){this._callbacks=_callbacks},KiiSocialConnectNetwork.prototype._getCallbacks=function(){return this._callbacks},KiiSocialConnectNetwork.prototype._isAuthenticated=function(){return null!=this._tokenObject},KiiSocialConnectNetwork.prototype._reset=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null,this._key=null,this._secret=null,this._extras=null},KiiSocialConnectNetwork.prototype._logIn=function(options,_callbacks){this._callbacks=_callbacks},KiiSocialConnectNetwork.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},KiiSocialConnectNetwork.prototype._linkWithCurrentUser=function(options,_callbacks){this._callbacks=_callbacks},KiiSocialConnectNetwork.prototype._unlinkFromCurrentUser=function(_callbacks){this._callbacks=_callbacks},KiiSocialConnectNetwork.prototype._setup=function(_key,_secret,_extras){this._key=_key,this._secret=_secret,this._extras=_extras},KiiSocialConnectNetwork}(),root.KiiSCNFacebook=function(_super){function KiiSCNFacebook(){this._unlinkFromCurrentUser=__bind(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=__bind(this._linkWithCurrentUser,this),this._logOut=__bind(this._logOut,this),this._logIn=__bind(this._logIn,this),this._unlink=__bind(this._unlink,this),this._link=__bind(this._link,this),this._register=__bind(this._register,this),this._setup=__bind(this._setup,this),KiiSCNFacebook.__super__.constructor.call(this,KiiSocialNetworkName.FACEBOOK)}var _authWindow;return __extends(KiiSCNFacebook,_super),_authWindow=null,KiiSCNFacebook.prototype._setup=function(_key,_secret,_extras){return this._key=_key,this._secret=_secret,this._extras=_extras,KiiSCNFacebook.__super__._setup.call(this,this._key,this._secret,this._extras),this._extras.appId=this._key,root.Kii.logger(this._extras),FB.init(this._extras)},KiiSCNFacebook.prototype._register=function(token,expires){var registrationCallbacks,request,_this=this;return _this=this,request=new KiiRequest("/integration/facebook",!0),request.setMethod("POST"),request.setData({accessToken:token}),request.setAnonymous(!0),request.setContentType("application/vnd.kii.AuthTokenFacebookRequest+json"),registrationCallbacks={success:function(data){var tokenObject,user;return _this._setToken(token),_this._setTokenExpiration(expires),tokenObject={access_token:token,expires_in:expires},_this._setTokenObject(tokenObject),user=new root.KiiUser,user._updateWithJSON(data),user._setAccessToken(data.access_token),root.Kii.setCurrentUser(user),null!=_this._callbacks?_this._callbacks.success(root.KiiUser.getCurrentUser(),_this._network):void 0},failure:function(error){return null!=_this._callbacks?_this._callbacks.failure(null,_this._network,error):void 0}},request.execute(registrationCallbacks,!1)},KiiSCNFacebook.prototype._link=function(token,expires){var linkCallbacks,request,_this=this;return _this=this,request=new KiiRequest("/users/me/facebook/link",!0),request.setMethod("POST"),request.setData({accessToken:token}),linkCallbacks={success:function(){var tokenObject;return _this._setToken(token),_this._setTokenExpiration(expires),tokenObject={access_token:token,expires_in:expires},_this._setTokenObject(tokenObject),null!=_this._callbacks?_this._callbacks.success(root.KiiUser.getCurrentUser(),_this._network):void 0},failure:function(error){return null!=_this._callbacks?_this._callbacks.failure(root.KiiUser.getCurrentUser(),_this._network,error):void 0}},request.execute(linkCallbacks,!0)},KiiSCNFacebook.prototype._unlink=function(){var request,unlinkCallbacks,_this=this;return _this=this,request=new KiiRequest("/users/me/facebook/unlink",!0),request.setMethod("POST"),unlinkCallbacks={success:function(){return _this._setToken(null),_this._setTokenExpiration(null),_this._setTokenObject(null),null!=_this._callbacks?_this._callbacks.success(root.KiiUser.getCurrentUser(),_this._network):void 0},failure:function(error){return null!=_this._callbacks?_this._callbacks.failure(root.KiiUser.getCurrentUser(),_this._network,error):void 0}},request.execute(unlinkCallbacks,!0)},KiiSCNFacebook.prototype._logIn=function(options,callbacks){var fbcallback,scope,statusCallback,_this=this;return KiiSCNFacebook.__super__._logIn.call(this,options,callbacks),root.Kii.logger("should auth fb"),_this=this,root.Kii.logger("Checking options"),root.Kii.logger(options),fbcallback=function(response){return null!=response.authResponse?(null!=root.KiiUser.getCurrentUser()&&KiiUser.logOut(),_this._register(response.authResponse.accessToken,response.authResponse.expiresIn)):null!=_this._callbacks?_this._callbacks.failure(null,_this._network,"User cancelled login or did not fully authorize"):void 0},null!=options&&null!=options.access_token?(root.Kii.logger("Have options: "),root.Kii.logger(options),null!=root.KiiUser.getCurrentUser()&&KiiUser.logOut(),_this._register(options.access_token,null)):(scope=null,null!=options&&null!=options.scope&&(scope={scope:options.scope}),statusCallback=function(response){return"connected"===response.status?fbcallback(response):FB.login(fbcallback,scope)},FB.getLoginStatus(statusCallback),statusCallback=function(response){return"connected"===response.status?fbcallback(response):FB.login(fbcallback)},FB.getLoginStatus(statusCallback))},KiiSCNFacebook.prototype._logOut=function(){return KiiSCNFacebook.__super__._logOut.apply(this,arguments),root.Kii.logger("Log out fb")},KiiSCNFacebook.prototype._linkWithCurrentUser=function(options,callbacks){var fbcallback,scope,statusCallback,_this;return KiiSCNFacebook.__super__._linkWithCurrentUser.call(this,options,callbacks),_this=this,fbcallback=function(response){return response.authResponse?_this._link(response.authResponse.accessToken,response.authResponse.expiresIn):null!=_this._callbacks?_this._callbacks.failure(null,_this._network,"User cancelled Facebook login or did not fully authorize"):void 0},null!=root.KiiUser.getCurrentUser()?null!=options&&null!=options.access_token?_this._link(options.access_token,null):(scope=null,null!=options&&null!=options.scope&&(scope={scope:options.scope}),statusCallback=function(response){return"connected"===response.status?fbcallback(response):FB.login(fbcallback,scope)},FB.getLoginStatus(statusCallback)):null!=callbacks?callbacks.failure("A KiiUser must be logged in before linking to Facebook"):void 0},KiiSCNFacebook.prototype._unlinkFromCurrentUser=function(callbacks){return KiiSCNFacebook.__super__._unlinkFromCurrentUser.call(this,callbacks),null!=root.KiiUser.getCurrentUser()?this._unlink():null!=callbacks?callbacks.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},KiiSCNFacebook}(root.KiiSocialConnectNetwork),root.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 4-50 characters."},root.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},root.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"},root.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"},root.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},root.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},root.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},root.InvalidCountryException=function(){return _this.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},root.InvalidURIException=function(){return _this.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},root.InvalidACLAction=function(){return _this.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},root.InvalidACLSubject=function(){return _this.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},root.InvalidACLGrant=function(){return _this.message="Unable to set ACL grant. Must be a boolean type"},root.InvalidLimitException=function(){return _this.message="Unable to set query limit. Must be an integer > 0"},root.InvalidArgumentException=function(message){return _this.message="InvalidArgument: "+message},root.KiiAppAdminContext=function(){function KiiAppAdminContext(spec){this._getToken=__bind(this._getToken,this),this._getId=__bind(this._getId,this),this._objectWithURI=__bind(this._objectWithURI,this),this._token=spec.token,this._id=spec.id}var _id,_token;return _token=null,_id=null,KiiAppAdminContext.prototype.bucketWithName=function(bucketName){var adminBucket;return adminBucket=new root.KiiBucketAdmin(bucketName,null,this._token)},KiiAppAdminContext.prototype.groupWithName=function(groupName){var group;return group=root.KiiGroupAdmin._groupWithName(groupName,this)},KiiAppAdminContext.prototype.userWithID=function(userid){var user;return user=root.KiiUserAdmin._userWithID(userid,this)},KiiAppAdminContext.prototype._userWithLoginName=function(loginName,callbacks){var refreshCallbacks,request,user;return user=new root.KiiUserAdmin(this),request=user._getRequest({path:"/users/LOGIN_NAME:"+loginName,withApp:!0}),request.setAdminToken(this._token),refreshCallbacks={success:function(data,statusCode){if(300>statusCode&&statusCode>=200){if(user._updateWithJSON(data),null!=callbacks)return callbacks.success(user)}else if(null!=callbacks)return callbacks.failure("Unable to parse response")},failure:function(error){return null!=callbacks?callbacks.failure(error):void 0}},request.execute(refreshCallbacks,!1)},KiiAppAdminContext.prototype._objectWithURI=function(objectUri){var bucket,bucketIndex,bucketName,compLength,components,group,newURI,obj,subject,user;if(newURI=objectUri.substr("kiicloud://".length),components=newURI.split("/"),compLength=components.length,!(compLength>=4))throw new root.InvalidURIException;return bucketIndex=4===compLength?1:3,bucketName=components[bucketIndex],"groups"===components[0]?group=new root.KiiGroupAdmin._groupWithID(components[1],this._token):"users"===components[0]&&(user=root.KiiUserAdmin._userWithID(components[1],this._token)),subject=null,null!=group?subject=group:null!=user&&(subject=user),bucket=new root.KiiBucketAdmin(bucketName,subject,this._token),obj=bucket.createObject(),obj._setUUID(components[compLength-1]),obj},KiiAppAdminContext.prototype._getId=function(){return this._id},KiiAppAdminContext.prototype._getToken=function(){return this._token},KiiAppAdminContext}(),root.KiiACLAdmin=function(_super){function KiiACLAdmin(parent,adminToken){this._userWithID=__bind(this._userWithID,this),this._groupWithID=__bind(this._groupWithID,this),this._getRequest=__bind(this._getRequest,this),KiiACLAdmin.__super__.constructor.call(this),this._setParent(parent),this._adminToken=adminToken}var _adminToken;return __extends(KiiACLAdmin,_super),_adminToken=null,KiiACLAdmin.prototype._getRequest=function(spec){var request;return request=KiiACLAdmin.__super__._getRequest.call(this,spec),request.setAdminToken(this._adminToken),request},KiiACLAdmin.prototype._groupWithID=function(id){var group;return group=root.KiiGroupAdmin._groupWithID(id,this._adminToken)},KiiACLAdmin.prototype._userWithID=function(id){var user;return user=root.KiiUserAdmin._userWithID(id,this._adminToken)},KiiACLAdmin}(root.KiiACL),root.KiiGroupAdmin=function(_super){function KiiGroupAdmin(adminContext){this._setOwnerFromContext=__bind(this._setOwnerFromContext,this),this._userWithID=__bind(this._userWithID,this),this.bucketWithName=__bind(this.bucketWithName,this),this._getRequest=__bind(this._getRequest,this),KiiGroupAdmin.__super__.constructor.call(this),this._adminContext=adminContext}var _adminContext;return __extends(KiiGroupAdmin,_super),_adminContext=null,KiiGroupAdmin.prototype._getRequest=function(spec){var request;return request=KiiGroupAdmin.__super__._getRequest.call(this,spec),request.setAdminToken(this._adminContext._getToken()),request},KiiGroupAdmin._groupWithName=function(groupName,adminContext){return root.KiiGroupAdmin._groupWithNameAndMembers(groupName,null,adminContext)},KiiGroupAdmin._groupWithNameAndMembers=function(groupName,members,adminContext){var group;return group=new root.KiiGroupAdmin(adminContext),group._setName(groupName),group._setAddMembers(members),group},KiiGroupAdmin._groupWithID=function(id,adminContext){var group;return group=new root.KiiGroupAdmin(adminContext),group._setUUID(id),group},KiiGroupAdmin.prototype.bucketWithName=function(name){var bucket;return bucket=new root.KiiBucketAdmin(name,this,this._adminContext._getToken())},KiiGroupAdmin.prototype._userWithID=function(id){var user;return user=root.KiiUserAdmin._userWithID(id,this._adminContext._getToken())},KiiGroupAdmin.prototype._setOwnerFromContext=function(){},KiiGroupAdmin}.call(this,root.KiiGroup),root.KiiObjectAdmin=function(_super){function KiiObjectAdmin(token){this._userWithID=__bind(this._userWithID,this),this.objectACL=__bind(this.objectACL,this),this._getRequest=__bind(this._getRequest,this),KiiObjectAdmin.__super__.constructor.call(this),this._adminToken=token}var _adminToken;return __extends(KiiObjectAdmin,_super),_adminToken=null,KiiObjectAdmin.prototype._getRequest=function(spec){var request;return root.Kii.logger("admin req: "+this._adminToken),request=KiiObjectAdmin.__super__._getRequest.call(this,spec),request.setAdminToken(this._adminToken),request},KiiObjectAdmin.objectWithBucket=function(bucket,type,adminToken){var obj;return root.Kii.logger("Creating object w type: "+type),obj=new root.KiiObjectAdmin(adminToken),obj._setBucket(bucket),obj._setObjectType(type),root.Kii.logger(obj),obj},KiiObjectAdmin.prototype.objectACL=function(){var acl;return acl=new root.KiiACLAdmin(this,this._adminToken)},KiiObjectAdmin.prototype._userWithID=function(id){var user;return user=root.KiiUserAdmin._userWithID(id,this._adminToken)},KiiObjectAdmin}.call(this,root.KiiObject),root.KiiUserAdmin=function(_super){function KiiUserAdmin(adminContext){this.bucketWithName=__bind(this.bucketWithName,this),this._getRequest=__bind(this._getRequest,this),KiiUserAdmin.__super__.constructor.call(this),this._adminContext=adminContext}var _adminContext;return __extends(KiiUserAdmin,_super),_adminContext=null,KiiUserAdmin._userWithID=function(id,adminContext){var user;return user=new root.KiiUserAdmin(adminContext),user._setUUID(id),user},KiiUserAdmin.prototype._getRequest=function(spec){var request;return request=KiiUserAdmin.__super__._getRequest.call(this,spec),request.setAdminToken(this._adminContext._getToken()),request},KiiUserAdmin.prototype.bucketWithName=function(bucketName){var bucket;return bucket=new root.KiiBucketAdmin(bucketName,this,this._adminContext._getToken())},KiiUserAdmin}.call(this,root.KiiUser),root.KiiAnonymousUser=function(){function KiiAnonymousUser(){}return KiiAnonymousUser}(),root.KiiAnyAuthenticatedUser=function(){function KiiAnyAuthenticatedUser(){}return KiiAnyAuthenticatedUser}(),root.KiiSDKClientInfo=function(){function KiiSDKClientInfo(){}var _clientInfo;return _clientInfo=null,KiiSDKClientInfo.getSDKClientInfo=function(){return null==KiiSDKClientInfo._clientInfo&&(KiiSDKClientInfo._clientInfo="sn=jss;sv="+root.Kii.getSDKVersion()),KiiSDKClientInfo._clientInfo},KiiSDKClientInfo}.call(this),root.KiiSCNTwitter=function(_super){function KiiSCNTwitter(){this._unlinkFromCurrentUser=__bind(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=__bind(this._linkWithCurrentUser,this),this._logOut=__bind(this._logOut,this),this._logIn=__bind(this._logIn,this),this._unlink=__bind(this._unlink,this),this._link=__bind(this._link,this),this._register=__bind(this._register,this),this._setup=__bind(this._setup,this),KiiSCNTwitter.__super__.constructor.call(this,KiiSocialNetworkName.TWITTER)}return __extends(KiiSCNTwitter,_super),KiiSCNTwitter.prototype._setup=function(_key,_secret,_extras){return this._key=_key,this._secret=_secret,this._extras=_extras,KiiSCNTwitter.__super__._setup.call(this,this._key,this._secret,this._extras)},KiiSCNTwitter.prototype._register=function(options,callbacks){var data,registrationCallbacks,request,_this=this;return _this=this,request=new KiiRequest("/integration/twitter",!0),request.setMethod("POST"),data={accessToken:options.oauth_token,accessTokenSecret:options.oauth_token_secret},request.setData(data),request.setAnonymous(!0),request.setContentType("application/vnd.kii.AuthTokenTwitterRequest+json"),registrationCallbacks={success:function(data){var tokenObject,user;
return _this._setToken(options.oauth_token),tokenObject={oauth_token:options.oauth_token,oauth_token_secret:options.oauth_token_secret},_this._setTokenObject(tokenObject),user=new root.KiiUser,user._updateWithJSON(data),user._setAccessToken(data.access_token),root.Kii.setCurrentUser(user),null!=callbacks?callbacks.success(root.KiiUser.getCurrentUser(),_this._network):void 0},failure:function(error){return null!=callbacks?callbacks.failure(null,_this._network,error):void 0}},request.execute(registrationCallbacks,!1)},KiiSCNTwitter.prototype._link=function(options,callbacks){var data,linkCallbacks,request,_this=this;return _this=this,request=new KiiRequest("/users/me/twitter/link",!0),request.setMethod("POST"),data={accessToken:options.oauth_token,accessTokenSecret:options.oauth_token_secret},request.setData(data),linkCallbacks={success:function(){var tokenObject;return _this._setToken(options.oauth_token),tokenObject={oauth_token:options.oauth_token,oauth_token_secret:options.oauth_token_secret},_this._setTokenObject(tokenObject),null!=callbacks?callbacks.success(root.KiiUser.getCurrentUser(),_this._network):void 0},failure:function(error){return null!=callbacks?callbacks.failure(root.KiiUser.getCurrentUser(),_this._network,error):void 0}},request.execute(linkCallbacks,!0)},KiiSCNTwitter.prototype._unlink=function(callbacks){var request,unlinkCallbacks,_this=this;return _this=this,request=new KiiRequest("/users/me/twitter/unlink",!0),request.setMethod("POST"),unlinkCallbacks={success:function(){return _this._setToken(null),_this._setTokenObject(null),null!=callbacks?callbacks.success(root.KiiUser.getCurrentUser(),_this._network):void 0},failure:function(error){return null!=callbacks?callbacks.failure(root.KiiUser.getCurrentUser(),_this._network,error):void 0}},request.execute(unlinkCallbacks,!0)},KiiSCNTwitter.prototype._logIn=function(options,callbacks){if(KiiSCNTwitter.__super__._logIn.call(this,options,callbacks),_this=this,root.Kii.logger("Checking options"),root.Kii.logger(options),null==options||!options.oauth_token&&!options.oauth_token_secret)throw root.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!options.oauth_token)throw root.InvalidArgumentException("options.oauth_token is required");if(!options.oauth_token_secret)throw root.InvalidArgumentException("options.oauth_token_secret is required");return null!=root.KiiUser.getCurrentUser()&&root.KiiUser.logOut(),_this._register(options,callbacks)},KiiSCNTwitter.prototype._logOut=function(){return KiiSCNTwitter.__super__._logOut.apply(this,arguments),root.Kii.logger("Log out twitter")},KiiSCNTwitter.prototype._linkWithCurrentUser=function(options,callbacks){if(_this=this,null==root.KiiUser.getCurrentUser())return void callbacks.failure(null,_this._network,"No user logged in");if(null==options||!options.oauth_token&&!options.oauth_token_secret)throw root.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!options.oauth_token)throw root.InvalidArgumentException("options.oauth_token is required");if(!options.oauth_token_secret)throw root.InvalidArgumentException("options.oauth_token_secret is required");return _this._link(options,callbacks)},KiiSCNTwitter.prototype._unlinkFromCurrentUser=function(callbacks){return _this=this,null==root.KiiUser.getCurrentUser()?void callbacks.failure(null,_this._network,"No user logged in"):this._unlink(callbacks)},KiiSCNTwitter}(root.KiiSocialConnectNetwork),root.KiiGeoPoint=function(){function KiiGeoPoint(_latitude,_longitude){var inRange;if(this._latitude=_latitude,this._longitude=_longitude,this._toDict=__bind(this._toDict,this),this.getLongitude=__bind(this.getLongitude,this),this.getLatitude=__bind(this.getLatitude,this),inRange=function(min,max,num){return num>min&&max>num&&!isNaN(num)},!inRange(-90,90,_latitude)||!inRange(-180,180,_longitude))throw root.InvalidArgumentException("Specified latitide or longitude is invalid")}return KiiGeoPoint.prototype.getLatitude=function(){return this._latitude},KiiGeoPoint.prototype.getLongitude=function(){return this._longitude},KiiGeoPoint.geoPoint=function(latitude,longitude){return new root.KiiGeoPoint(latitude,longitude)},KiiGeoPoint.prototype._toDict=function(){var dict;return dict={_type:"point",lat:this._latitude,lon:this._longitude}},KiiGeoPoint}.call(this),root};!function(){var b="undefined"!=typeof module&&null!==module;b&&module.exports?module.exports={create:function(){return ctor.call(this)}}:ctor()}(),function(){"use strict";function withStore(type,f){if(db)f(db.transaction(STORENAME,type).objectStore(STORENAME));else{var openreq=indexedDB.open(DBNAME,DBVERSION);openreq.onerror=function(){console.error("asyncStorage: can't open database:",openreq.error.name)},openreq.onupgradeneeded=function(){openreq.result.createObjectStore(STORENAME)},openreq.onsuccess=function(){db=openreq.result,f(db.transaction(STORENAME,type).objectStore(STORENAME))}}}function getItem(key,callback){withStore("readonly",function(store){var req=store.get(key);req.onsuccess=function(){var value=req.result;void 0===value&&(value=null),callback(value)},req.onerror=function(){console.error("Error in asyncStorage.getItem(): ",req.error.name)}})}function setItem(key,value,callback){withStore("readwrite",function(store){null===value&&(value=void 0);var req=store.put(value,key);callback&&(req.onsuccess=function(){callback()}),req.onerror=function(){console.error("Error in asyncStorage.setItem(): ",req.error.name)}})}function removeItem(key,callback){withStore("readwrite",function(store){var req=store.delete(key);callback&&(req.onsuccess=function(){callback()}),req.onerror=function(){console.error("Error in asyncStorage.removeItem(): ",req.error.name)}})}function clear(callback){withStore("readwrite",function(store){var req=store.clear();callback&&(req.onsuccess=function(){callback()}),req.onerror=function(){console.error("Error in asyncStorage.clear(): ",req.error.name)}})}function length(callback){withStore("readonly",function(store){var req=store.count();req.onsuccess=function(){callback(req.result)},req.onerror=function(){console.error("Error in asyncStorage.length(): ",req.error.name)}})}function key(n,callback){return 0>n?void callback(null):void withStore("readonly",function(store){var advanced=!1,req=store.openCursor();req.onsuccess=function(){var cursor=req.result;return cursor?void(0===n?callback(cursor.key):advanced?callback(cursor.key):(advanced=!0,cursor.advance(n))):void callback(null)},req.onerror=function(){console.error("Error in asyncStorage.key(): ",req.error.name)}})}var DBNAME="asyncStorage",DBVERSION=1,STORENAME="keyvaluepairs",db=null,asyncStorage={getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key};"function"==typeof define&&define.amd?define(function(){return asyncStorage}):"undefined"!=typeof module&&module.exports?module.exports=asyncStorage:this.asyncStorage=asyncStorage}.call(this),function(){"use strict";function clear(callback){localStorage.clear(),callback&&callback()}function getItem(key,callback){var result=localStorage.getItem(key);result&&(result=JSON.parse(result)),callback&&callback(result)}function key(n,callback){callback&&callback(localStorage.key(n))}function length(callback){callback&&callback(localStorage.length)}function removeItem(key,callback){localStorage.removeItem(key),callback&&callback()}function setItem(key,value,callback){try{value=JSON.stringify(value)}catch(e){console.error("Couldn't convert value into a JSON string: ",value)}localStorage.setItem(key,value),callback&&callback(value)}var localStorage;window.chrome&&window.chrome.runtime||(localStorage=window.localStorage);var localStorageWrapper={getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,get:getItem,set:setItem,remove:removeItem,removeAll:clear};"function"==typeof define&&define.amd?define(function(){return localStorageWrapper}):"undefined"!=typeof module&&module.exports?module.exports=localStorageWrapper:this.localStorageWrapper=localStorageWrapper}.call(this),function(){"use strict";var storageLibrary,indexedDB=indexedDB||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB;if(storageLibrary=indexedDB?"asyncStorage":"localStorageWrapper","function"==typeof define&&define.amd)define([storageLibrary],function(lib){return lib});else if("undefined"!=typeof module&&module.exports){var lib=require("./"+storageLibrary);module.exports=lib}else this.localForage=this[storageLibrary]}.call(this),function(){"use strict";function debug(val1,val2){if(DEBUG)if(void 0===val2)if("boolean"==typeof val1)val1?console.info("[JUKAX:INFO]","TRUE"):console.error("[JUKAX:ERROR]","FALSE");else if("number"==typeof val1)switch(val1){case 3:console.error("[JUKAX:ERROR] 3:ERROR_SAVING_DATA");break;case 4:console.error("[JUKAX:ERROR] 4:ERROR_CREATING_USER");break;case 5:console.error("[JUKAX:ERROR] 5:ERROR_QUERY_FAILURE");break;case 6:console.error("[JUKAX:ERROR] 6:ERROR_LOGIN");break;case 7:console.error("[JUKAX:ERROR] 7:ERROR_REFRESHING_DATA");break;case 8:console.error("[JUKAX:ERROR] 8:ERROR_DELETING_USER");break;case 9:console.error("[JUKAX:ERROR] 9:ERROR_UNVALID_INPUT");break;case 10:console.error("[JUKAX:ERROR] 10:ERROR_UPDATING_PASSWORD");break;case 11:console.error("[JUKAX:ERROR] 11:ERROR_CLEANINGUP_EVENTS");break;default:console.info("[JUKAX:INFO]",val1)}else"string"==typeof val1?console.info("[JUKAX:INFO]",val1):console.info("[JUKAX:INFO]",val1.toString());else if("number"==typeof val1&&"array"==typeof val2)switch(val1){case 3:console.error("[JUKAX:ERROR] 3:ERROR_SAVING_DATA",val2);break;case 4:console.error("[JUKAX:ERROR] 4:ERROR_CREATING_USER",val2);break;case 5:console.error("[JUKAX:ERROR] 5:ERROR_QUERY_FAILURE",val2);break;case 6:console.error("[JUKAX:ERROR] 6:ERROR_LOGIN",val2);break;case 7:console.error("[JUKAX:ERROR] 7:ERROR_REFRESHING_DATA",val2);break;case 8:console.error("[JUKAX:ERROR] 8:ERROR_DELETING_USER",val2);break;case 9:console.error("[JUKAX:ERROR] 9:ERROR_UNVALID_INPUT",val2);break;case 10:console.error("[JUKAX:ERROR] 10:ERROR_UPDATING_PASSWORD",val2);break;case 11:console.error("[JUKAX:ERROR] 11:ERROR_CLEANINGUP_EVENTS",val2);break;default:console.info("[JUKAX:INFO]",val1,val2)}else 1===val1?console.error("[JUKAX:ERROR]",val2):val1===val2?console.info("[JUKAX:info]",val1,"====",val2):console.error("[JUKAX:ERROR]",val1,"!==",val2)}function ready(fn){alreadyReady?fn():whenReady=fn}function itsReady(){alreadyReady=!0,whenReady&&whenReady()}function storagesSet(storages){storages="undefined"!=typeof storages?storages:{},storages.hasOwnProperty("local")&&(Storages.local=storages.local),storages.hasOwnProperty("Kii")&&(Storages.Kii=storages.Kii)}function initializeKii(appID,appKey,kii_site){if(!Storages.Kii)throw debug(1,"Kii is not set as a Storage"),"Kii is not set as a Storage";kii_site="undefined"!=typeof kii_site?kii_site:KiiSite.US,Kii.initializeWithSite(appID,appKey,kii_site)}function accountCreate(username,password,fn){fn="undefined"!=typeof fn?fn:{};try{user=KiiUser.userWithUsername(username,password),user.register({success:function(Auser){debug("registred user"),keepLogin&&(loginToken=Auser.getAccessToken(),localForage.setItem("loginToken",loginToken)),isLogin=!0,bucket=Auser.bucketWithName("data"),data=bucket.createObject(),data.set("data",{}),data.saveAllFields({success:function(theObject){debug("all data fields saved"),theObject.refresh({success:function(obj){debug("data refreshed"),data=obj,fn.hasOwnProperty("success")&&fn.success()},failure:function(obj,error){debug(7,[error]),fn.hasOwnProperty("failure")&&fn.failure({type:7,message:error})}})},failure:function(theObject,errorString){fn.hasOwnProperty("failure")&&(debug(3,[errorString]),fn.failure({type:3,message:errorString}))}})},failure:function(theUser,errorString){debug(4,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:4,message:errorString})}})}catch(e){throw debug(1,e),e.message}}function accountLogin(username,password,fn){fn="undefined"!=typeof fn?fn:{};var callBack={success:function(Auser){debug("loged user"),user=Auser,keepLogin&&(loginToken=Auser.getAccessToken(),localForage.setItem("loginToken",loginToken)),isLogin=!0,bucket=user.bucketWithName("data");var query=KiiQuery.queryWithClause(),queryCallbacks={success:function(queryPerformed,r){debug("Queryed for data"),data=r[0],fn.success()},failure:function(queryPerformed,errorString){debug(5,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:5,message:errorString})}};bucket.executeQuery(query,queryCallbacks)},failure:function(theUser,errorString){debug(6,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:6,message:errorString})}};loginToken?(debug("Loging with Token"),KiiUser.authenticateWithToken(loginToken,callBack)):(debug("Loging with username/pw"),KiiUser.authenticate(username,password,callBack))}function accountKeepLogin(keep,callback){return void 0===keep?keepLogin&&loginToken:void(keep?(debug("KeepLogin set to True"),keepLogin=!0,localForage.setItem("keepLogin",!0,callback)):(debug("KeepLogin set to False"),keepLogin=!1,loginToken=!1,localForage.setItem("keepLogin",!1,function(){localForage.setItem("loginToken",null,callback)})))}function accountLogout(){data.save({success:function(){debug("data saved"),KiiUser.logOut(),debug("logged out"),accountKeepLogin(!1),isLogin=!1},failure:function(){debug(3),KiiUser.logOut(),debug("logged out")}})}function accoutSave(fn){fn="undefined"!=typeof fn?fn:{},data.save({success:function(){debug("data saved"),fn.hasOwnProperty("success")&&fn.success()},failure:function(obj,errorString){debug(3,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:3,message:errorString})}})}function accountDelete(fn){fn="undefined"!=typeof fn?fn:{},user.delete({success:function(){debug("user deleted"),fn.hasOwnProperty("success")&&(accountKeepLogin(!1),isLogin=!1,fn.success())},failure:function(user,errorString){debug(8,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:8,message:errorString})}})}function accountUpdatePassword(old_pw,new_pw,fn){try{""!==old_pw&&null!==old_pw&&""!==new_pw&&null!==new_pw?user.updatePassword(old_pw,new_pw,{success:function(){debug("password updated"),accountKeepLogin(!1),isLogin=!1,fn.hasOwnProperty("success")&&fn.success()},failure:function(user,errorString){fn.hasOwnProperty("failure")&&(debug(10,[errorString]),fn.failure({type:10,message:errorString}))}}):fn.hasOwnProperty("failure")&&fn.failure({type:9,message:"Unvalid Input"})}catch(e){throw debug(1,e),e.message}}function eventsCleanup(fn){data.delete({success:function(){debug("data removed"),data=user.bucketWithName("data").createObject(),data.set("data",{}),data.save({success:function(o){debug("data saved"),data=o,data.refresh({success:function(d){debug("data refreshed"),data=d,fn.hasOwnProperty("success")&&fn.success()},failure:function(obj,errorString){debug(7,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:7,message:errorString})}})},failure:function(obj,errorString){debug(3,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:3,message:errorString})}})},failure:function(obj,errorString){debug(11,[errorString]),fn.hasOwnProperty("failure")&&fn.failure({type:11,message:errorString})}})}function eventsUpdate(YMD,event){var j,eventIndex=-1,CurrentEvent={},eventsData=data.get("data");if(eventsData.hasOwnProperty(YMD)||(eventsData[YMD]=[]),event.hasOwnProperty("created")&&null!==event.created){for(j=0;j<eventsData[YMD].length;j++)if(eventsData[YMD][j].created===event.created){eventIndex=j;break}}else event.created=Date.now();CurrentEvent.title=event.hasOwnProperty("title")?event.title:"Note",CurrentEvent.where=event.hasOwnProperty("where")?event.where:"",CurrentEvent.note=event.hasOwnProperty("note")?event.note:"",CurrentEvent.time=event.hasOwnProperty("time")?event.time:"",CurrentEvent.repeat=event.hasOwnProperty("repeat")?event.repeat:"once",CurrentEvent.reminder=event.hasOwnProperty("reminder")?event.reminder:"no",CurrentEvent.level=event.hasOwnProperty("level")?event.level:"A",CurrentEvent.created=event.created,eventIndex>-1?eventsData[YMD][eventIndex]=CurrentEvent:(eventsData[YMD].push(CurrentEvent),eventsData[YMD].sort(function(a,b){return parseInt(a.time.split(":").join(""),10)-parseInt(b.time.split(":").join(""),10)})),data.set("data",eventsData),data.save({success:function(){},failure:function(){}})}function eventsDelete(YMD,created){var j,eventsData=data.get("data"),eventIndex=-1;if(eventsData.hasOwnProperty(YMD)){for(j=0;j<eventsData[YMD].length;j++)if(eventsData[YMD][j].created===created){eventIndex=j;break}-1!==eventIndex&&(eventsData[YMD].splice(eventIndex,1),0===eventsData[YMD].length&&delete eventsData[YMD],data.set("data",eventsData),data.saveAllFields({success:function(){},failure:function(){}}))}}function eventsObject(){return{title:"",where:"",note:"",time:"",repeat:"once",reminder:"no",level:"A",created:Date.now()}}function eventsGet(YMD,created){if(!isLogin||!data.get("data").hasOwnProperty(YMD))return null;if(void 0!==created){var j,eventIndex=-1;for(j=0;j<data.get("data")[YMD].length;j++)if(data.get("data")[YMD][j].created===created){eventIndex=j;break}return eventIndex>-1?data.get("data")[YMD][eventIndex]:null}return data.get("data")[YMD]}function dataGet(){return isLogin?data:null}function userGet(){return isLogin?user:null}var jukax,user,data,bucket,ERROR_SAVING_DATA=3,ERROR_CREATING_USER=4,ERROR_QUERY_FAILURE=5,ERROR_LOGIN=6,ERROR_REFRESHING_DATA=7,ERROR_DELETING_USER=8,ERROR_UNVALID_INPUT=9,ERROR_UPDATING_PASSWORD=10,ERROR_CLEANINGUP_EVENTS=11,Storages={local:!1,Kii:!1},whenReady=null,alreadyReady=!1,isLogin=!1,keepLogin=!1,loginToken=null,DEBUG=!0;localForage.getItem("keepLogin",function(item){item?(keepLogin=item,localForage.getItem("loginToken",function(item2){loginToken=item2,item2?itsReady():(keepLogin=!1,localForage.setItem("keepLogin",!1,itsReady))})):(item=!1,localForage.setItem("keepLogin",!1,function(){localForage.setItem("loginToken",null,itsReady)}))}),jukax=window.jukax={userGet:userGet,dataGet:dataGet,bucket:bucket,ERROR_SAVING_DATA:ERROR_SAVING_DATA,ERROR_CREATING_USER:ERROR_CREATING_USER,ERROR_QUERY_FAILURE:ERROR_QUERY_FAILURE,ERROR_LOGIN:ERROR_LOGIN,ERROR_REFRESHING_DATA:ERROR_REFRESHING_DATA,ERROR_DELETING_USER:ERROR_DELETING_USER,ERROR_UNVALID_INPUT:ERROR_UNVALID_INPUT,ERROR_UPDATING_PASSWORD:ERROR_UPDATING_PASSWORD,ERROR_CLEANINGUP_EVENTS:ERROR_CLEANINGUP_EVENTS,initializeKii:initializeKii,accountCreate:accountCreate,accountLogin:accountLogin,accountLogout:accountLogout,accountUpdatePassword:accountUpdatePassword,accountDelete:accountDelete,eventsCleanup:eventsCleanup,eventsNew:eventsUpdate,eventsUpdate:eventsUpdate,eventsDelete:eventsDelete,eventsObject:eventsObject,eventsGet:eventsGet,storagesSet:storagesSet,accountKeepLogin:accountKeepLogin,accoutSave:accoutSave,ready:ready,debug:debug}}(),$(function(){"use strict";function newEventItem(event,YMD){return'<li class="tag-'+event.level+'" data-created="'+event.created+'" data-ymd="'+YMD+'"><a><h3>'+(event.title||"Unidentified")+(event.where?" <small>("+event.where+")</small>":"")+"</h3><p>"+event.note+'</p><p class="ui-li-aside">'+event.time+"</p></a></li>"}function updateListview(){var i,listView=document.getElementById("listview"),YMD=year+month+day,events=jukax.eventsGet(YMD),listViewContent="";if($.mobile.loading("show"),null!==events)for(i=0;i<events.length;i++)listViewContent+=newEventItem(events[i],YMD);listview.removeClass("hidden"),listView.innerHTML=listViewContent,listview.listview("refresh"),$.mobile.loading("hide")}function daysInMonth(year,month){return[31,year%4===0&&year%100!==0||year%400===0?29:28,31,30,31,30,31,31,30,31,30,31][month]}function buildCal(year,month){window.year=year,window.month=month;var dayOnMonth,time=(new Date).getTime(),tbody=document.getElementsByTagName("tbody")[0],firstDay=new Date(year+"-"+month).getDay(),daysNbre=daysInMonth(parseInt(year,10),parseInt(month,10)-1),tbodyContent="<tr>",i=1;for(i=0;firstDay>i;i++)tbodyContent+='<td class="empty"></td>';for(dayOnMonth=1;daysNbre>=dayOnMonth;dayOnMonth++)8===++i&&(tbodyContent+="</tr><tr>",i=1),tbodyContent+='<td data-ymd="'+year+month+dayOnMonth.toString()+'" class="day-on-month'+(jukax.eventsGet(year+month+dayOnMonth.toString())?' date-has-event">':'">')+dayOnMonth.toString()+"</td>";for(i;7>i;i++)tbodyContent+='<td class="empty"></td>';tbodyContent+="</tr>",listview.empty(),newb.hide(),monthField.text(months[parseInt(month,10)-1]+" "+year),$("#controlgroup").controlgroup(),tbody.innerHTML=tbodyContent,console.log("Calendar created on:",(new Date).getTime()-time)}function nextMonth(){month=(parseInt(month,10)+1).toString(),"13"===month?(month="01",year=(parseInt(year,10)+1).toString(),$("#select-year").val(year).selectmenu("refresh")):1===month.length&&(month="0"+month),$("#select-month").val(months[parseInt(month,10)-1]).selectmenu("refresh"),buildCal(year,month)}function prevMonth(){month=(parseInt(month,10)-1).toString(),"0"===month?(month="12",year=(parseInt(year,10)-1).toString(),$("#select-year").val(year).selectmenu("refresh")):1===month.length&&(month="0"+month),$("#select-month").val(months[parseInt(month,10)-1]).selectmenu("refresh"),buildCal(year,month)}function getHM(){var time=new Date,hours=time.getHours(),minutes=time.getMinutes();return hours=10>hours?"0"+hours.toString():hours.toString(),minutes=10>minutes?"0"+minutes.toString():minutes.toString(),hours+":"+minutes}function newEvent(){form.title.val(""),form.where.val(""),form.note.val(""),form.time.val(getHM()),form.level="A",$("#level-A").prop("checked",!0),form.created=null,$("#delete").hide(),$.mobile.changePage("#eventPage"),$("#level-radio :radio").checkboxradio("refresh"),form.ymd=year+month+day}function buildeventsList(){var i,events,datesData,date,evlist=$("#eventsList"),evList=document.getElementById("eventsList"),evListContent="";$.mobile.loading("show"),evlist.empty(),jukax.dataGet()&&(datesData=jukax.dataGet().get("data"));for(date in datesData)if(datesData.hasOwnProperty(date)&&(events=jukax.eventsGet(date)))for(evListContent+='<li data-date="'+date+'" data-role="list-divider">'+date.substring(6)+"/"+date.substr(4,2)+"/"+date.substr(0,4)+'<span class="ui-li-count">'+events.length.toString()+"</span></li>",i=0;i<events.length;i++)evListContent+=newEventItem(events[i],date);evList.innerHTML=evListContent,$.mobile.changePage("#events"),lastPage="#events",evlist.listview("refresh"),$.mobile.loading("hide"),evlist.listview("option","hideDividers",!0)}function deleteEvent(created,YMD){jukax.eventsDelete(YMD,created),"#events"===lastPage&&buildeventsList(),$.mobile.changePage(lastPage),updateListview(),jukax.eventsGet(YMD)||YMD.substr(0,6)!==year+month||$("[data-ymd="+YMD+"]").removeClass("date-has-event")}function editEvent(created,YMD){var e=jukax.eventsGet(YMD,created);null===e?newEvent():(form.title.val(e.title.replace("&lt;","<","g").replace("&gt;",">","g")),form.where.val(e.where.replace("&lt;","<","g").replace("&gt;",">","g")),form.note.val(e.note.replace("&lt;","<","g").replace("&gt;",">","g")),form.time.val(e.time),form.level=e.level,$("#level-"+e.level).prop("checked",!0),form.created=e.created,$("#delete").click(function(){deleteEvent(created,YMD)}),$("#delete").show(),$.mobile.changePage("#eventPage"),$("#level-radio").controlgroup("refresh"))}function saveEvent(){var event={title:form.title.val(),where:form.where.val(),note:form.note.val(),time:form.time.val().trim(),repeat:"once",reminder:"no",level:$("#level-radio input:checked").val(),created:form.created},time=/^([012]?\d) *: *([012345]?\d)(?::\d{1,2}\.?\d{0,2})? *(am|pm)?$/i.exec(event.time);event.time&&(!time||time[3]&&parseInt(time[1],10)>12)&&(time=null),event.title||event.note?event.title&&event.title.length>42?($("#event-err-msg").text("Title sould not be more than 42 characters").css("color","red").show(200,"linear"),setTimeout(function(){$("#event-err-msg").hide()},6e3)):event.time&&!time?($("#event-err-msg").text("Time is not valid").css("color","red").show(200,"linear"),setTimeout(function(){$("#event-err-msg").hide()},6e3)):(event.time=time?(1===time[1].length?"0"+time[1]:time[1])+":"+(1===time[2].length?"0"+time[2]:time[2])+(time[3]?" "+time[3]:""):"",event.title=event.title.replace("<","&lt;","g").replace(">","&gt;","g"),event.where=event.where.replace("<","&lt;","g").replace(">","&gt;","g"),event.note=event.note.replace("<","&lt;","g").replace(">","&gt;","g"),jukax.eventsUpdate(form.ymd||year+month+day,event),"#events"===lastPage&&buildeventsList(),$.mobile.changePage(lastPage),updateListview(),selectedDay&&selectedDay.addClass("date-has-event")):($("#event-err-msg").text("You should put at least a title or a note.").css("color","red").show(200,"linear"),setTimeout(function(){$("#event-err-msg").hide()},6e3))}function confirmAndDelete(listitem,transition){listitem.children(".ui-btn").addClass("ui-btn-active"),$("#confirmDelete").popup("open"),$("#confirmDelete .yes").on("click",function(){jukax.eventsDelete(year+month+day,listitem.data("created")),transition?listitem.addClass(transition).on("webkitTransitionEnd transitionend otransitionend",function(){listitem.remove(),listview.listview("refresh").find(".border-bottom").removeClass("border-bottom")}).prev("li").children("a").addClass("border-bottom").end().end().children(".ui-btn").removeClass("ui-btn-active"):(listitem.remove(),listview.listview("refresh")),jukax.eventsGet(year+month+day)||selectedDay.removeClass("date-has-event")}),$("#confirmDelete .cancel").on("click",function(){listitem.removeClass("ui-btn-active"),$("#confirmDelete .yes").off()})}function performRegistration(){var username=$("#username").val(),password=$("#password").val();username.length<4||password.length<4?($("#login-err-msg").text("Username and Password should be at least 4 charachters").css("color","red").show(200,"linear"),setTimeout(function(){$("#login-err-msg").hide()},3e3)):($.mobile.loading("show"),jukax.accountKeepLogin(!1,function(){jukax.accountKeepLogin($("#keepLogin").prop("checked"),function(){try{jukax.accountCreate(username,password,{success:function(){buildCal(year,month),$("#select-month").val(months[parseInt(month,10)-1]).selectmenu("refresh"),$("#select-year").val(year).selectmenu("refresh"),$.mobile.changePage("#cal"),$("#username").val(""),$("#password").val(""),$.mobile.loading("hide")},failure:function(e){$.mobile.loading("hide"),void 0===typeof window.navigator||void 0===typeof window.navigator.onLine||window.navigator.onLine?e.type===jukax.ERROR_CREATING_USER&&(e.message.indexOf("USER_ALREADY_EXISTS")>-1&&(e.message="user already exists"),$("#login-err-msg").text("Unable to register: "+e.message).css("color","red").show(200,"linear"),setTimeout(function(){$("#login-err-msg").hide()},3e3)):($("#login-err-msg").text("Unable to register: check your network connection").css("color","red").show(200,"linear"),setTimeout(function(){$("#login-err-msg").hide()},4e3))}})}catch(e){$("#login-err-msg").text("Unable to register: "+e.message).css("color","red").show(200,"linear"),setTimeout(function(){$("#login-err-msg").hide()},3e3)}})}))}function performLogin(){var username=$("#username").val(),password=$("#password").val();username.length<4||password.length<4?($("#login-err-msg").text("Username and Password should be at least 4 charachters").css("color","red").show(200,"linear"),setTimeout(function(){$("#login-err-msg").hide()},3e3)):($.mobile.loading("show"),jukax.accountKeepLogin(!1,function(){var username=$("#username").val(),password=$("#password").val();jukax.accountKeepLogin($("#keepLogin").prop("checked"),function(){jukax.accountLogin(username,password,{success:function(){buildCal(year,month),$.mobile.changePage("#cal"),$("#select-month").val(months[parseInt(month,10)-1]).selectmenu("refresh"),$("#select-year").val(year).selectmenu("refresh"),$("#username").val(""),$("#password").val(""),$.mobile.loading("hide")},failure:function(e){$.mobile.loading("hide"),void 0===typeof window.navigator||void 0===typeof window.navigator.onLine||window.navigator.onLine?e.type===jukax.ERROR_LOGIN&&($("#login-err-msg").text("Unable to login: check your input").css("color","red").show(200,"linear"),setTimeout(function(){$("#login-err-msg").hide()},3e3)):($("#login-err-msg").text("Unable to login: check your network connection").css("color","red").show(200,"linear"),setTimeout(function(){$("#login-err-msg").hide()},4e3))}})})}))}function logout(){jukax.accountLogout(),$.mobile.changePage("#login"),date=new Date,year=date.getFullYear().toString(),month=(date.getMonth()+1).toString(),day=date.getDate().toString()}var calendarDayClicked,selectedDay,monthField=$("#monthField"),listview=$("#listview"),newb=$("#new"),selectDate=$("#select-date"),lastPage="#cal",form={title:$("#title"),where:$("#where"),note:$("#note"),time:$("#time"),repeat:"once",reminder:"no",level:"A",created:null,ymd:null},date=new Date,months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year=date.getFullYear().toString(),month=(date.getMonth()+1).toString(),day=date.getDate().toString();1===month.length&&(month="0"+month),calendarDayClicked=function(){selectedDay&&selectedDay.removeClass("selected"),selectedDay=$(this).addClass("selected"),day=$(this).text(),listview.addClass("hiden"),updateListview(),newb.show()},window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,1)},1)},!1),jukax.storagesSet({Kii:!0}),jukax.initializeKii("ea716d13","60ac553a1539a79cf9f44a98642be971"),buildCal(year,month),$("#select-month").val(months[parseInt(month,10)-1]),$("#select-year").val(year),jukax.ready(function(){jukax.accountKeepLogin()?($.mobile.changePage("#cal"),$.mobile.loading("show",{text:"Downloading Data...",textVisible:!0,theme:"b"}),jukax.accountLogin(null,null,{success:function(){buildCal(year,month),$.mobile.loading("hide")},failure:function(){$.mobile.changePage("#login"),$.mobile.loading("hide"),jukax.accountKeepLogin("false")}})):$.mobile.changePage("#login")}),$("#register-button").click(performRegistration),$("#login-button").click(performLogin),$("#logout").click(logout),$("#logout2").click(logout),$("#deleteaccountbutton").click(function(){jukax.accountDelete({success:function(){$("#deleteaccountmessage").text("Done!").css("color","green").show(200,"linear"),setTimeout(function(){$("#deleteaccountmessage").hide(),$.mobile.changePage("#login")},2e3)},failure:function(){$("#deleteaccountmessage").text("Failed!").css("color","red").show(200,"linear"),setTimeout(function(){$("#deleteaccountmessage").hide(),$.mobile.loadPage("#login")},3e3)}})}),$("#updatepasswordbutton").click(function(){try{jukax.accountUpdatePassword($("#updatepasswordold").val(),$("#updatepasswordnew").val(),{success:function(){$("#updatepasswordmessage").text("Done! Relogin needed!").css("color","green").show(200,"linear"),setTimeout(function(){jukax.accountLogout(),$("#updatepasswordmessage").hide(),$.mobile.changePage("#login")},3e3),$("#updatepasswordnew").val(""),$("#updatepasswordold").val("")},failure:function(e){e.type===jukax.ERROR_UNVALID_INPUT?($("#updatepasswordmessage").text("Unvalid Input!").css("color","red").show(200,"linear"),setTimeout(function(){$("#updatepasswordmessage").hide()},3e3)):e.type===jukax.ERROR_UPDATING_PASSWORD&&($("#updatepasswordmessage").text("Failed!").css("color","red").show(200,"linear"),setTimeout(function(){$("#updatepasswordmessage").hide()},3e3),$("#updatepasswordnew").val(""),$("#updatepasswordold").val(""))}})}catch(e){$("#updatepasswordmessage").text("Failed!").css("color","red").show(200,"linear"),setTimeout(function(){$("#updatepasswordmessage").hide()},3e3),$("#updatepasswordnew").val(""),$("#updatepasswordold").val("")}}),$("#deletedatabutton").click(function(){jukax.eventsCleanup({success:function(){buildCal(year,month),$("#deletedatamessage").text("Done!").css("color","green").show(200,"linear"),setTimeout(function(){$("#deletedatamessage").hide(200)
},3e3),"#events"===lastPage&&buildeventsList()},failure:function(e){e.type===jukax.ERROR_CLEANINGUP_EVENTS?($("#deletedatamessage").text("Failed!").css("color","red").show(200,"linear"),setTimeout(function(){$("#deletedatamessage").hide()},3e3)):($("#deletedatamessage").text("Relogin needed!").css("color","yellow").show(200,"linear"),setTimeout(function(){$("#deletedatamessage").hide(),$.mobile.changePage("#login")},3e3))}})}),$("#gotoCal").click(function(){lastPage="#cal",$.mobile.changePage("#cal")}),$("#prevMonth").click(prevMonth),$("#nextMonth").click(nextMonth),newb.click(newEvent),$("#save").click(saveEvent),$("#gotoEvents").click(buildeventsList),$("#backbutton").click(function(){$.mobile.changePage(lastPage)}),$.mobile.support.touch||listview.removeClass("touch"),$.event.special.swipe.horizontalDistanceThreshold=70,$(document).on("swipeleft swiperight","tbody",function(event){"swipeleft"===event.type?nextMonth():prevMonth()}),$("#monthCheckbox").click(function(){selectDate.toggle(400)}),$("#select-year").change(function(){year=$(this).val(),buildCal(year,month)}),$("#select-month").change(function(){month=(months.indexOf($(this).val())+1).toString(),1===month.length&&(month="0"+month),buildCal(year,month)}),$(document).on("submit","form",function(e){return e.preventDefault(),!1}),$(document).on("click","#listview li",function(){form.ymd=$(this).data("ymd"),editEvent($(this).data("created"),$(this).data("ymd").toString())}),$(document).on("click","#eventsList>li[data-created]",function(){form.ymd=$(this).data("ymd"),editEvent($(this).data("created"),$(this).data("ymd").toString())}),$(document).on("click",".day-on-month",calendarDayClicked),$(document).on("swipeleft swiperight","#listview li",function(event){var listitem=$(this),dir="swipeleft"===event.type?"left":"right",transition=$.support.cssTransform3d?dir:!1;confirmAndDelete(listitem,transition)}),$.mobile.hashListeningEnabled=!1});
//# sourceMappingURL=main.js.map